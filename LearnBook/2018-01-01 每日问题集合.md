### **æ¯æ—¥é—®é¢˜é›†**

https://zhuanlan.zhihu.com/everyday-lin
https://medium.com/@nawarpianist/git-commit-best-practices-dab8d722de99


flask æŸ¥è¯¢æ•°æ®æœ‰ç¼“å­˜ 
æŸ¥è¯¢å‰å…ˆ `db.session.commit()` å°†å½“å‰ session å¯¹è±¡é‡Œçš„ç¼“å­˜æäº¤ï¼ˆæ¸…ç©ºç¼“å­˜ï¼‰ï¼ŒæŸ¥è¯¢æ—¶å°±ç›´æ¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æœ€æ–°æ•°æ®ã€‚
https://www.cnblogs.com/huchong/p/9258458.html
https://www.jianshu.com/p/c0a8275cce99

## 2020-03-02

```
File "/usr/local/lib/python3.6/site-packages/pymysql/err.py", line 109, 
in raise_mysql_exception raise errorclass(errno, errval)
sqlalchemy.exc.InternalError: (pymysql.err.InternalError) 
(1267, "Illegal mix of collations (latin1_swedish_ci,IMPLICIT) 
and (utf8_general_ci,COERCIBLE) for operation '='")
```

é”™è¯¯åŸå› æ˜¯æ•°æ®åº“å­—ç¬¦é›†å’Œè¡¨çš„å­—ç¬¦é›†ä¸åŒ¹é…å¯¼è‡´çš„ã€‚
 æŸ¥çœ‹å­—ç¬¦é›†æ–¹æ³•ï¼š

```
show variables like "%char%";
show variables like "%coll%";
```

è§£å†³æ–¹æ³•1ï¼š
ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†ä¿®æ”¹ä¸º utf8mb4 æ ¼å¼
 å‚è€ƒï¼š
https://stackoverflow.com/a/1008336/10267639
https://stackoverflow.com/questions/32511288/illegal-mix-of-collations-utf8mb4-unicode-ci-explicit-and-utf8-general-ci-coe
https://blog.51cto.com/bian5399/1092772
 è§£å†³æ–¹æ³•2:
 æ–°å»ºæ•°æ®åº“æ—¶æŒ‡å®šæ•°æ®åº“å­—ç¬¦é›†ï¼š

```
create database xxx default CHARACTER 
set utf8mb4 COLLATE utf8mb4_unicode_ci;
```



## 2020-02-25

pycharm å¯åŠ¨flaské¡¹ç›® é»˜è®¤å¯åŠ¨éƒ½æ˜¯`127.0.0.1:5000`(å³ä½¿æŒ‡å®šå¯åŠ¨çš„ipã€port)
è§£å†³æ–¹æ³•ï¼š
åœ¨additional optionsä¸­æ·»åŠ ï¼šâ€”host=172.16.16.28 â€”port=6001
[Image: image.png]
## 2020-01-17 

### dockerä¸­æ—¥å¿—æŸ¥æ‰¾

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/38207098/10267639

```
docker logs --since 1m -f container_id | grep "has no attribute"
```

### æ—¥å¿—è¾“å‡ºå†æŸ¥æ‰¾

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/37269320/10267639 

```
`docker logs nginx ``>`` stdout``.``log ``2``>``stderr``.``log`
`cat stdout``.``log ``|`` grep ``"has no attribute."`
```




### python f-string

å‚è€ƒé“¾æ¥ï¼šhttp://zetcode.com/python/fstring/
**æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤§æ¯”æ‹¼ï¼š**str.formatæœ€æ…¢ï¼Œ%sçš„ç¨å¿«ä¸€ç‚¹ï¼ŒF-stringæ˜¯æœ€å¿«çš„ï¼
Python 3.6æ–°å¢äº†f-stringsï¼Œè¿™ä¸ªç‰¹æ€§å«åš`å­—é¢é‡æ ¼å¼åŒ–å­—ç¬¦ä¸²`ï¼ŒFå­—ç¬¦ä¸²æ˜¯å¼€å¤´æœ‰ä¸€ä¸ªfçš„å­—ç¬¦ä¸²æ–‡å­—ï¼ŒPythonä¼šè®¡ç®—å…¶ä¸­çš„ç”¨å¤§æ‹¬å·åŒ…èµ·æ¥çš„è¡¨è¾¾å¼ï¼Œå¹¶å°†è®¡ç®—åçš„å€¼æ›¿æ¢è¿›å»ã€‚


```
`In : name = 'lin'

In : f'Hello {name}'
Out: 'Hello Lin'

In : f'Hello {name.upper()}'
Out: 'Hello LIN'

In : d = {'id': 123, 'name': 'lin'}

In : f'User[{d["id"]}]: {d["lin"]}'
Out: 'User[123]: lin'`
```



## 2020-01-14 

openpyxl å»é™¤é»˜è®¤çš„Sheet 
æŸ¥è¯¢å…³é”®è¯ï¼š openpyxl remove  default Sheet 
å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/46327467/openpyxl-not-removing-sheets-from-created-workbook-correctly
https://stackoverflow.com/a/51628232/10267639

```
`xlsx = Workbook()
xlsx.create_sheet('other name')
xlsx.remove(xlsx['Sheet'])
xlsx.save('some.xlsx')`
```

## 2020-01-13

è·å–æ•°æ®åº“çš„å½“å‰æ—¶é—´

```
current_time = db.engine.execute('select NOW();').fetchone()
```

## 2020-01-09 

zipå‹ç¼©å¤ªå¤šçš„æ–‡ä»¶ä¼šå¯¼è‡´éƒ¨åˆ†æ–‡ä»¶æŸåï¼Œå»ºè®®åªæ‰“åŒ…ã€‚

## 2020-01-08 

linux æ–‡æœ¬ä¸­æ‰¹é‡æ›¿æ¢

```
# esc 
:%s/10.10/test.cn/
```



## git commit best practices 

https://stackoverflow.com/q/6543913/10267639
https://www.perforce.com/blog/vcs/git-commit-best-practices-streamline-development


## flask : how to architect the project with multiple apps?

https://stackoverflow.com/questions/15583671/flask-how-to-architect-the-project-with-multiple-apps
https://dev.to/paurakhsharma/flask-rest-api-part-2-better-structure-with-blueprint-and-flask-restful-2n93

flaskä¸­çš„blueprint ä½¿ç”¨ResponseæŠ¥é”™ï¼Œä½†èƒ½æ­£å¸¸è¿”å›æ•°æ®

```
return Response((result, status_code,
        {'Content-Type': 'application/sse/json;charset=utf-8'})) # å¤šåŠ äº†ä¸€ä¸ªæ‹¬å·
        
# å¯¼è‡´é”™è¯¯ 
Traceback (most recent call last):
  File "/Users/xiaoqinglin-guanliyuan/.local/share/virtualenvs/DataFlowTools-Yd81hy1s/lib/python3.7/site-packages/werkzeug/serving.py", line 302, in run_wsgi
    execute(self.server.app)
  File "/Users/xiaoqinglin-guanliyuan/.local/share/virtualenvs/DataFlowTools-Yd81hy1s/lib/python3.7/site-packages/werkzeug/serving.py", line 293, in execute
    write(data)
  File "/Users/xiaoqinglin-guanliyuan/.local/share/virtualenvs/DataFlowTools-Yd81hy1s/lib/python3.7/site-packages/werkzeug/serving.py", line 273, in write
    assert isinstance(data, bytes), "applications must write bytes"
AssertionError: applications must write bytes
```

å‚è€ƒé“¾æ¥ï¼šhttps://dev.to/paurakhsharma/flask-rest-api-part-2-better-structure-with-blueprint-and-flask-restful-2n93

```
***return****** ***Response(result, status_code, mimetype='application/json;charset=utf-8')
or 
***return ***Response(result, status=status_code, mimetype='application/json;charset=utf-8')
```




## 2020-01-07 

linuxæŸ¥çœ‹æ–‡ä»¶å±‚çº§ä¸­æ–‡æ˜¾ç¤ºå¼‚å¸¸

```
tree -L 2 -N 
.
â”œâ”€â”€ x3b_annu_2016_test
â”‚   â”œâ”€â”€ [430002]2016å¹´å¹´åº¦æŠ¥å‘Š.txt
â”‚   â”œâ”€â”€ [430003]2016å¹´å¹´åº¦æŠ¥å‘Š.txt
â”‚   â””â”€â”€ [430005]2016å¹´å¹´åº¦æŠ¥å‘Š.txt
â””â”€â”€ x3b_ipo_test
    â”œâ”€â”€ [2008-06-17][430029]è‚¡ä»½æŠ¥ä»·è½¬è®©è¯´æ˜ä¹¦.txt
    â”œâ”€â”€ [2008-08-27][430031]è‚¡ä»½æŠ¥ä»·è½¬è®©è¯´æ˜ä¹¦.txt
    â””â”€â”€ [2008-10-23][430033]è‚¡ä»½æŠ¥ä»·è½¬è®©è¯´æ˜ä¹¦.txt
```

## 2020-01-03 

å›¾æ•°æ®åº“ï¼š
https://github.com/jbmusso/awesome-graph
https://awesomeopensource.com/projects/graph-database

è§£é‡Šä¸€ä¸‹ORM:
ORMï¼ˆobject-Relational Mapper ORMï¼‰ï¼šORMæ˜¯ä¸€ä¸ªæ•°æ®æŠ½è±¡å±‚ï¼Œæè¿°å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„è¡¨ã€è¡Œå’Œåˆ—ã€‚
ç±»ï¼šæ•°æ®åº“ä¸­çš„è¡¨
å±æ€§ï¼šåˆ—
ç±»çš„å•ä¸ªå®ä¾‹ï¼šæ•°æ®åº“ä¸­çš„ä¸€è¡Œæ•°æ®


## 2020-01-02

### re.escape(pattern)

è½¬ä¹‰patternä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚å¦‚æœæƒ³å¯¹ä»»æ„å¯èƒ½åŒ…å«æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦çš„æ–‡æœ¬å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…ã€‚

```
print(re.escape('http://www.python.org'))
http://www\.python\.org 

operators = ['+', '-', '*', '/', '**'] 
print('|'.join(map(re.escape, sorted(operators, reverse=**True**))))
/|\-|\+|\*\*|\*
```



## 2020-01-01 

How to Install Chrome Driver on Mac (2019 Update)
å‚è€ƒé“¾æ¥ï¼šhttps://www.swtestacademy.com/install-chrome-driver-on-mac/


## 2019-12-27 

https://github.com/pypa/pipenv/issues/598
pipfileã€pipfile.lock æ˜¯å¦éœ€è¦æ·»åŠ åˆ°gitç®¡ç†


## 2019-12-24 

**AttributeError: dlsym(0xXXXXXXX, archive_read_support_filter_all): symbol not found** 
å‡çº§pycharmå°±å¯ä»¥äº†ï¼Œä¸è¦æµªè´¹æ—¶é—´å»æ‰¾è§£å†³æ–¹æ¡ˆã€‚

https://youtrack.jetbrains.com/issue/PY-39242?_ga=2.51641066.273994328.1577257370-1427562534.1537330810#focus=streamItem-27-3845736.0-0

å¦‚æœè¦æ‰¾è§£å†³æ–¹æ¡ˆï¼Œçœ‹ä¸‹é¢ï¼ˆä½†éƒ½æ²¡æœ‰è§£å†³é—®é¢˜ï¼‰ï¼š
https://stackoverflow.com/questions/34386527/symbol-not-found-pycodecinfo-getincrementaldecoder
https://ephrain.net/mac-%E5%9F%B7%E8%A1%8C-python-%E5%87%BA%E7%8F%BE-symbol-not-found-__pycodecinfo_getincrementaldecoder-%E9%8C%AF%E8%AA%A4/
https://stackoverflow.com/a/37745394


## 2019-12-22 

 **â€œ'chromedriver' executable needs to be available in the pathâ€**
å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/29858752/error-message-chromedriver-executable-needs-to-be-available-in-the-path
https://chromedriver.storage.googleapis.com/index.html?path=80.0.3987.16/

```
`brew install chromedriver`
```

æ–¹æ³•äºŒï¼š

```
`pip install webdriver-manager`
```

```
`from selenium import webdriverfrom webdriver_manager.chrome import ChromeDriverManager

driver = webdriver.Chrome(ChromeDriverManager().install())`
```

## 2019-11-06 peewee insert 

```
# MySQL supports upsert via the ON DUPLICATE KEY UPDATE clause. For example:

class User(Model):
    username = TextField(unique=True)
    last_login = DateTimeField(null=True)
    login_count = IntegerField()

# Insert a new user. æ–°å»ºä¸€ä¸ªç”¨æˆ·
User.create(username='huey', login_count=0)

# Simulate the user logging in. 
# The login count and timestamp will be either created or updated correctly.
now = datetime.now()
rowid = (User
         .insert(username='huey', last_login=now, login_count=1)
         .on_conflict(
             preserve=[User.last_login],  # Use the value we would have inserted.
             update={User.login_count: User.login_count + 1})
         .execute())
```



## 2019-10-29 

## Git-è§£é‡Šâ€œSwap file .MERGE_MSG.swp already existsâ€çš„é—®é¢˜

å‚è€ƒï¼šhttps://stackoverflow.com/questions/41284031/how-to-solve-git-merge-error-swap-file-merge-msg-swp-already-exists
æ“ä½œæ­¥éª¤ï¼š

```
1ã€å›åˆ°åˆå¹¶å‰çŠ¶æ€
git merge -abort  // ä¸­æ­¢åˆå¹¶
rm .git/.MERGE_MSG.sw* //åˆ é™¤ vim éæ­£å¸¸å…³é—­äº§ç”Ÿçš„æ–‡ä»¶

2ã€é‡æ–°åˆå¹¶
åˆå¹¶æäº¤ä¿¡æ¯é¡µé¢ï¼Œä½¿ç”¨ :wq! æˆ–è€… :q! æ­£å¸¸é€€å‡º VIM ï¼Œå°±èƒ½æ­£å¸¸åˆå¹¶å•¦ã€‚

PSï¼š
å¦‚æœ .git/MERGE_* æ–‡ä»¶ä¸­ åªæœ‰ MERGE_MSG æ–‡ä»¶çš„è¯ï¼Œ
ä¸ç”¨æ‰§è¡Œ git merge -abort ,ç›´æ¥åˆ é™¤ .MERGE_MSG.sw* æ–‡ä»¶å°±å¥½


```

## 2019-09-10 

### Flask-SQLAlchemy æ ¹æ®mysqlæ•°æ®åº“è¡¨åå‘ç”Ÿæˆ modelçš„ pyæ–‡ä»¶

æ•°æ®è¡¨ï¼š

```
CREATE TABLE IF NOT EXISTS running (
    host VARCHAR(250), # ä¸»æœº
    last_beat_time DATETIME,
);
```

å®‰è£…åŒ…ï¼š

```
pip install flask-sqlacodegen 
```

æ‰§è¡Œå‘½ä»¤å‚è€ƒï¼š

```
`flask``-``sqlacodegen "mysql+pymysql://username:password@host/db_name"`` ``--``tables `
`table_name ``--``outfile ``"file_name"`` ``--``flask`
```

```
flask-sqlacodegen "mysql+pymysql://root:xiaoqinglin@127.0.0.1/db_demo"
--tables running --outfile "test1.py" --flask 
```

è¾“å‡ºæ–‡ä»¶ç¤ºä¾‹ï¼š

```
class RunningState(db.Model):
    __tablename__ = 'running'

    host = db.Column(db.String(250), primary_key=True, nullable=False)
    last_beat_time = db.Column(db.DateTime)
```

https://cloud.tencent.com/developer/article/1127765 modelç”Ÿæˆæ•°æ®åº“è¡¨


## 2019-08-12

**é—®é¢˜1: æ¸…ç©ºshellä¸­çš„history å†å²è®°å½•ï¼š** 

```
history -c 
```


**é—®é¢˜2:csvæ–‡ä»¶å»é™¤æŒ‡å®šä¾‹ä¸ºç©ºçš„å€¼åéšæœºæŠ½å–**
pandasä¸­ä¸¤ä¸ªdataframeåšå·®é›†

```
import pandas as pd 

def random_select(json_path):
    df = pd.read_csv(json_path, encoding='utf-8')
    dn = df[df.å®¡æ‰¹æ„è§.isnull() & df.å‰ææ¡ä»¶.isnull() & df.ç®¡ç†æ¡ä»¶.isnull() & df.éæ ¼å¼åŒ–å®¡æ‰¹å†…å®¹.isnull()]
    df.append(dn)
    ds = df.drop_duplicates(subset=['å®¡æ‰¹æ„è§', 'å‰ææ¡ä»¶', 'ç®¡ç†æ¡ä»¶', 'éæ ¼å¼è¯å®¡æ‰¹ä¹¦å†…å®¹'], keep=False)
    random_df = ds.sample(frac=0.1)
    # å¹¶æœªåœ¨åŸæœ‰dfä¸Šæ’åºï¼Œè€Œæ˜¯æ’åºåè¿”å›
    sort_df = random_df.sort_values(by=['äº§å“ç§ç±»'], axis=0, ascending=False)
    sort_df.to_csv('sample_0830.csv', index=False)    
```

## **2019-08-28**

ä»winæœ¬åœ°ç§»åŠ¨æ–‡ä»¶åˆ°dockeræŒ‡å®šçš„ç›®å½•ä¸­ ï¼Œä¸­æ–‡æ–‡ä»¶åä¹±ç ã€‚
åˆ†æé—®é¢˜å‡ºç°çš„åŸå› ï¼š

1. æ£€æŸ¥shellå‘½ä»¤è¡Œæ˜¯å¦å¯ä»¥è¾“å…¥æ­£æ–‡ï¼›
2. æ£€æŸ¥ä»£ç ä¸­çš„ä¸­æ–‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚

è‹¥1ã€2éƒ½æ²¡æœ‰é—®é¢˜ï¼Œåˆ™åŸå› ä¸ºï¼š
ç”±äºzipæ ¼å¼ä¸­å¹¶æ²¡æœ‰æŒ‡å®šç¼–ç æ ¼å¼ï¼ŒWindowsä¸‹ç”Ÿæˆçš„zipæ–‡ä»¶ä¸­çš„ç¼–ç æ˜¯GBK/GB2312ç­‰ï¼Œå› æ­¤ï¼Œå¯¼è‡´è¿™äº›zipæ–‡ä»¶åœ¨Linuxä¸‹è§£å‹æ—¶å‡ºç°ä¹±ç é—®é¢˜ï¼Œå› ä¸ºLinuxä¸‹çš„é»˜è®¤ç¼–ç æ˜¯UTF8ã€‚ç›®å‰ç½‘ä¸Šæµä¼ ä¸€ç§unzip -O cp936çš„æ–¹æ³•ï¼Œä½†ä¸€äº›unzipæ˜¯æ²¡æœ‰-Oè¿™ä¸ªé€‰é¡¹çš„ã€‚

è§£å†³æ–¹æ³•ï¼š

1. zip  å‹ç¼©æ–‡ä»¶
2. ä¸Šä¼ å‹ç¼©æ–‡ä»¶è‡³æœåŠ¡å™¨
3. è§£å‹æ–‡ä»¶ï¼šunzip -O cp936 demo.zip



## 2019-08-27 

å’”å’”å’”ï¼Œæ— å¤„ä¸åœ¨çš„ç¼–ç é—®é¢˜
https://www.codeleading.com/article/64661585737/

### è¯»å–csvæ–‡ä»¶æŠ¥é”™ï¼š

https://stackoverflow.com/questions/22216076/unicodedecodeerror-utf8-codec-cant-decode-byte-0xa5-in-position-0-invalid-s

```
 UnicodeDecodeError: 'utf8' codec can't decode byte 0xa5 in position 0: 
 invalid start byte (https://stackoverflow.com/questions/22216076
 /unicodedecodeerror-utf8-codec-cant-decode-byte-0xa5-in-position-0-invalid-s)
```

```
def random_select(json_path):
    df = pd.read_csv(json_path, encoding='gb18030') # æƒå®œä¹‹è®¡
    random_df = df.sample(frac=0.1)
    # å¹¶æœªåœ¨åŸæœ‰dfä¸Šæ’åºï¼Œè€Œæ˜¯æ’åºåè¿”å›
    sort_df = random_df.sort_values(by=["äº§å“ç§ç±»"], axis=0, ascending=False) 
    sort_df.to_csv('choice_0108.csv', index=False) # index=False,ä¸å†™å…¥ç´¢å¼•
    
***if****** ***__name__ == "__main__":
    choice_cols('path')
```

## 2019-08-21 

### windowsä¸­æ–‡ä»¶è·¯å¾„é—®é¢˜ï¼ˆè¿™winçœŸä¸æ˜¯å¥½æƒ¹çš„ä¸»ï¼Œå¤ªğŸ¥šç—›äº†ï¼‰ï¼š

è‹¥æ–‡ä»¶è·¯å¾„ä¸­å«æœ‰ç±»ä¼¼æ ¼å¼ï¼š

```
%Y-%m-%d_%H:%M:%S
```

### å†™å…¥æ–‡ä»¶æŠ¥é”™ï¼š â€œPython OSError: [Errno 22] Invalid argument...â€

OMGä¿®æ”¹ä¸€ä¸‹ï¼š

```
%Y_%m_%d_%H_%M_%S
```

### win conda æºç å®‰è£…åŒ…

ä¸‹è½½æ‰€éœ€è¦çš„åŒ…ï¼šhttps://anaconda.org/conda-forge/repo?sort=time.modified&sort_order=asc&page=14&label=gcc7

```
å°†` ...tar.bz2` çš„æ–‡ä»¶æ”¾åˆ°ï¼š`c:ProgramData\Anaconda3\pkgs`
```

[Tinge Zhang](https://hujialou.quip.com/ZNPAEAwKHdp)

æ‰“å¼€cmdï¼Œcondaä¸æ˜¯å†…éƒ¨å‘½ä»¤, é…ç½®ç¯å¢ƒå˜é‡ 

æˆ‘çš„ç”µè„‘-å±æ€§-é«˜çº§ç³»ç»Ÿè®¾ç½®-é«˜çº§-ç¯å¢ƒå˜é‡-ç³»ç»Ÿå˜é‡-Path-ç¼–è¾‘
æ·»åŠ 

```
C:\ProgramData\Anaconda3\Scripts
```

```
cd C:\ProgramData\Anaconda3\pkgs
```

```
`conda install --`use`-`local`  ...tar.bz2 `
```

## 2019-08-20 

è§£å†³xshellç»ˆç«¯ä¸­æ–‡æ˜¾ç¤ºä¹±ç 

```
export `LC_ALL=zh_CN.utf-8 `
```

è§£å†³xftpæ˜¾ç¤ºä¸­æ–‡ä¹±ç 

```
File ---> properties ---> Options ---> **å‹¾é€‰ Use UTF-8 encoding**
```

* * *

```
å¿ƒå¥½ç´¯ï¼š
ä»æ­¤ä¸è®ºæ˜¯ç”¨å•¥ï¼ˆpandasã€openï¼‰è¯»å–æ–‡ä»¶ã€å†™å…¥æ–‡ä»¶ï¼Œéƒ½ä¸»åŠ¨åŠ ä¸Šï¼ˆ**encoding****=****'utf-8'**ï¼‰ã€‚
è¿è¡Œä»»ä½•å‘½ä»¤ï¼šå‡¡æ˜¯æœ‰æ–‡ä»¶è·¯å¾„éƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚
ä»»ä½•è½¯ä»¶ç¼–ç ä¸€å¾‹ï¼šutf-8 
```

## 2019-08-12 

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/53356077/10267639

```
error: each element of 'ext_modules' option must be an Extension instance or
 2-tuple
```

ä¿®æ”¹ï¼š
I had to reorder import statements to get rid of this error. This code generates the error:

```
`from Cython.Build import cythonize
from setuptools import find_packages, setup`
```

This code does not generate the error:

```
`from setuptools import find_packages, setup
from Cython.Build import cythonize`
```




## 2019-06-20 

é—®é¢˜1: 
åŸç”Ÿæ­£åˆ™è¡¨è¾¾å¼ ä¸ºä»€ä¹ˆä¸åŒ¹é…å•è¯(ä¸¤ä¸ªå­—ç¬¦)ï¼Ÿ

```
eg:  [^(åŒ—äº¬)]*  -->é”™è¯¯ç†è§£ï¼šä¸åŒ¹é… "åŒ—äº¬" è¿™ä¸ªå•è¯ï¼Œä½†å¯åŒ¹é… åŒ—æµ· åŒ—å¹³
                -->æ­£ç¡®ç†è§£ï¼šåªè¦å‡ºç°  â€œåŒ—â€ æˆ– â€œäº¬â€ çš„å¥å­éƒ½ä¸åŒ¹é…ã€‚
                . æ˜¯åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œè€Œ[^]æ˜¯ä¸åŒ¹é…æŸä¸ªå­—ç¬¦ï¼Œ
                .*
                [^]*
```

## 2019-06-19

é—®é¢˜1:(ä¼°è®¡è¿˜ä¼šå†ç”¨åˆ°çš„)

### é€‚é… ä¼šè®®å±Šæ¬¡ çš„æ­£åˆ™

```
re.compile('(?P<meeting_num>ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]å±Š.{0,15}ç¬¬?[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3}?æ¬¡(.{0,8}?ä¼šè®®)?(ï¼ˆä¸´æ—¶ä¼šè®®ï¼‰)?)'),
re.compile('(?P<meeting_num>ç¬¬?[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]å±Š.{0,15}ç¬¬?[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3}?æ¬¡(.{0,8}?ä¼šè®®)?(ï¼ˆä¸´æ—¶ä¼šè®®ï¼‰)?)'),
re.compile('(?P<meeting_num>\d{4}å¹´(?!(\d{1,2}æœˆ)).*?ç¬¬(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3})æ¬¡(.{0,8}?ä¼šè®®)?(ï¼ˆä¸´æ—¶ä¼šè®®ï¼‰)?)'),
re.compile('(?P<meeting_num>ç¬¬?[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]å±Š.*?ç¬¬\d{1,3}æ¬¡(.{0,8}?ä¼šè®®)?(ï¼ˆä¸´æ—¶ä¼šè®®ï¼‰)?)'),
re.compile('(?P<meeting_num>ç¬¬\då±Š.*?ç¬¬\d{1,3}æ¬¡(.{0,8}?ä¼šè®®)?)(ï¼ˆä¸´æ—¶ä¼šè®®ï¼‰)?'),
```

### é€‚é… ä¼šè®®æ—¶é—´ çš„æ­£åˆ™

```
re.compile("(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥(?:[ä¸Šä¸‹]åˆ.{0,5})?(?:\d{1,2}[:ï¼š]\d{1,2})?)(?:(?:å¬å¼€|ä¸¾è¡Œ)|åœ¨((?!å‘å‡º)[^ï¼›ã€‚ï¼Œ]){2,50}?(?:å¬å¼€|ä¸¾è¡Œ)|ä»¥((?!å‘å‡º)[^ï¼›ã€‚ï¼Œ]){2,50}?æ–¹å¼(?:å¬å¼€|ä¸¾è¡Œ))"),
re.compile(
"(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥(?:[ä¸Šä¸‹]åˆ.{0,5})?(?:ï¼ˆæ˜ŸæœŸ[ä¸€äºŒä¸‰å››äº”å…­æ—¥]ï¼‰)?(?:\d{1,2}[:ï¼š]\d{1,2})?)((?!å‘å‡º)[^ï¼›ã€‚ï¼Œ]){1,20}?(?:(?:å¬å¼€|ä¸¾è¡Œ)|åœ¨[^ã€‚ï¼›ï¼Œ]{2,50}?(?:å¬å¼€|ä¸¾è¡Œ)|ä»¥[^ã€‚ï¼›ï¼Œ]{2,50}?æ–¹å¼(?:å¬å¼€|ä¸¾è¡Œ))"),
re.compile("(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥)[^ï¼›ã€‚]{0,30}?(?:è‘£äº‹ä¼š)[^ï¼›ã€‚]{0,30}?(?:ä¸¾è¡Œ)"),
re.compile(
"(?P<date>[é›¶Oâ—‹ã€‡ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{4}å¹´[é›¶Oâ—‹ã€‡ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,2}æœˆ[é›¶Oâ—‹ã€‡ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3}æ—¥)[^ï¼›ã€‚]{0,30}?(?:[^å‘å‡ºäº†](?:å¬å¼€|ä¸¾è¡Œ)|åœ¨[^ã€‚ï¼›]{2,30}?(?:å¬å¼€|ä¸¾è¡Œ)|ä»¥[^ã€‚ï¼›]{2,30}?æ–¹å¼(?:å¬å¼€|ä¸¾è¡Œ))"),
re.compile("^(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥)[^ï¼›ã€‚]{0,40}?(?:å¬å¼€|ä¸¾è¡Œ)"),
# 2019 å¹´ 1 æœˆ 29 æ—¥ä»¥ç°åœº+é€šè®¯æ–¹å¼å¬å¼€
re.compile('(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥)[^ï¼Œ]*?ä»¥(ç°åœº+é€šè®¯æ–¹å¼|ç°åœºç»“åˆé€šè®¯è¡¨å†³æ–¹å¼)å¬å¼€'),
# 2018å¹´6æœˆ22æ—¥ï¼Œä¼šè®®ä»¥é€šè®¯è¡¨å†³æ–¹å¼å¬å¼€
# å¬å¼€æ—¶é—´ï¼š2018å¹´1æœˆ17æ—¥
re.compile("å†³è®®è¡¨å†³æˆªæ­¢æ—¥ä¸º(?P<date>\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥)"),
re.compile('(å¬å¼€|ä¼šè®®)æ—¶é—´[ï¼š:](?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥(?:[ä¸Šä¸‹]åˆ)?(?:\d{1,2}[:ï¼š]\d{1,2})?)'),
re.compile("å¹¶äº.*?(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥).{1,10}?é€šè¿‡ä¼šè®®å†³è®®"),
re.compile(
".*?é€šçŸ¥.{1,30}?ï¼Œ.{1,30}?(?P<date>(\d{4}å¹´)?\d{1,2}æœˆ.{1,8}?æ—¥(?:[ä¸Šä¸‹]åˆ)?(?:\d{1,2}[:ï¼š]\d{1,2})?).*?(ç°åœº)?å¬å¼€"),
re.compile(
".*?é€šçŸ¥.{1,30}?ï¼Œ.{1,30}?(?P<date>(\d{4}å¹´)?\d{1,2}æœˆ.{1,8}?æ—¥(?:[ä¸Šä¸‹]åˆ)?(?:\d{1,2}[:ï¼š]\d{1,2})?).*?(?:å¬å¼€|ä¸¾è¡Œ)"),
re.compile("(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥).*?ä¼šè®®å®¤"),
re.compile("ä¼šè®®äº.*?(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥).*?(ç°åœº)?å¬å¼€"),
re.compile("(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥).*?(?:å¬å¼€|ä¸¾è¡Œ)"),
re.compile("äº(?P<date>\d{1,2}æœˆ.{1,8}?æ—¥).*?é€šè®¯(è¡¨å†³)?æ–¹å¼å¬å¼€"),
re.compile("ä¼šè®®äº.*?(?P<date>\d{4}å¹´\d{1,2}æœˆ\d).*?(ç°åœº)?å¬å¼€"),
re.compile("ä¼šè®®è¡¨å†³æˆªæ­¢æ—¶é—´ä¸º(?P<date>\d{4}å¹´\d{1,2}æœˆ.{1,8}?æ—¥)"),
```



## 2019-06-18

é—®é¢˜1:

```
# ä½¿ç”¨ ä¸Šä¸‹æ–‡ç®¡ç†å™¨ æ—¶ï¼Œä¸€å®šåŠ ä¸Šå­—ç¬¦ç¼–ç ï¼Œä¸ç„¶å„ç§å‘å‘¢
with open('xxx.xxx', 'w', encoding='utf-8') as f: 
    pass  
```




## 2019-5-19 

### æ­£åˆ™ä¸­å¸¸ç”¨çš„å‰åæŸ¥æ‰¾æ“ä½œç¬¦

|æ“ä½œç¬¦	|è¯´æ˜	|
|---	|---	|
|(?=)	|æ­£å‘å‰æŸ¥æ‰¾	|
|(?!)	|è´Ÿå‘å‰æŸ¥æ‰¾	|
|(?<=)	|æ­£å‘åæŸ¥æ‰¾	|
|(?<!)	|è´Ÿå‘åæŸ¥æ‰¾	|

## 2019-5-15

### é—®é¢˜1

pathlibçš„ä½¿ç”¨
https://docs.python.org/3/library/pathlib.html

```
str(pathlib.Path(__file__).resolve().parents[2])
```



## 2019-5-14

### é—®é¢˜1: 

mysql ä¸­æ•°æ®å…¥åº“å‘ç”Ÿé”™è¯¯ï¼š ` 1264    Out of range value for column 'xxxxx' at row 864`

### é—®é¢˜åŸå› ï¼š

### å­—æ®µçš„å€¼è¶…è¿‡å…¶å¯è¾“å…¥çš„èŒƒå›´äº†ï¼Œæ¯”å¦‚ï¼šint(10)ï¼Œä½†å¯¼å…¥çš„æ•°æ®ä¸­æœ‰è¶…å‡ºæ­¤èŒƒå›´

### è§£å†³æ–¹æ³•ï¼š

æŠŠå­—æ®µçš„ç±»å‹æ”¹ä¸€ä¸‹ï¼Œeg: ä¿®æ”¹ä¸ºbigint(50)


### é—®é¢˜2:

å­—ç¬¦ä¸²è½¬ä¸ºdecimal
å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/questions/4643991/python-converting-string-into-decimal-number

```
`from decimal import Decimal

price = "1098,965.0000"
price_in_decimal = Decimal(price.replace(',',''))`
```

### é—®é¢˜3ï¼š

æ—¶é—´è®¡ç®—
å‚è€ƒé“¾æ¥ï¼šhttps://dateutil.readthedocs.io/en/stable/relativedelta.html å¥½ç”¨

```
# å®‰è£… pip install python-dateutil
from datetime import date 
***from ***dateutil.relativedelta ***import ***relativedelta

# æ˜¯years ä¸æ˜¯year 
>>> date.today() + relativedelta(years=-2, months=+1)
datetime.date(2017, 6, 15)
```




## 2019-05-13

åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦åœ¨å†…çš„ä»»æ„å­—ç¬¦ï¼‰

```
[\s\S]*
```



## 2019-05-07 

## é—®é¢˜1ï¼š

è™½ç„¶åœ¨pycharmä¸­é…ç½®äº†æå–éœ€è¦çš„ç›¸å…³æ¨¡æ¿ï¼ˆæå–æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ã€patternæ–‡ä»¶ã€caseæ–‡ä»¶å¤¹ï¼‰ï¼Œä½†éƒ½è¦åˆ°æŒ‡å®šçš„ç›®å½•ä¸‹æ–°å»ºï¼Œæœ‰ç‚¹éº»çƒ¦

### è§£å†³æƒ³æ³•ï¼š

1ã€è¿è¡Œè„šæœ¬ï¼Œåœ¨ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆç›¸åº”çš„æ¨¡æ¿æ–‡ä»¶

## é—®é¢˜2:

ä¸¤ä¸ªlistï¼Œæ±‚å¹¶é›†ã€äº¤é›†ã€å·®é›†  

```
lis1 = []
lis2 = []

# å¹¶é›†
res_1 = set(lis1) | set(lis2)

# äº¤é›†
res_2 = set(lis1) & set(lis2)

# å·®é›†
res_3 = set(lis1) - set(lis2)

#  (ä¹Ÿå¯ç”¨differenceã€unionã€intersectionï¼Œä½†...)
```

## é—®é¢˜3

### mac å¤šè¿›ç¨‹è¿è¡ŒæŠ¥é”™

```
"""
objc[89654]: +[__NSPlaceholderDictionary initialize] may have been in progress in another thread when fork() was called.
objc[89654]: +[__NSPlaceholderDictionary initialize] may have been in progress in another thread when fork() was called.
 We cannot safely call it or ignore it in the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.
"""
```

è§£å†³æ–¹æ³•ï¼š
å‚è€ƒé“¾æ¥ï¼šhttps://github.com/rtomayko/shotgun/issues/69
æ·»åŠ ï¼š
`OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES`
[Image: image.png]

## 2019-05-06

 ä½¿ç”¨peewee,å½“éœ€è¦æŸ¥è¯¢æ•°æ®è¡¨ä¸­æŸæ¡æ•°æ®æ˜¯å¦å­˜åœ¨æ—¶ï¼Œæ¨èä½¿ç”¨ï¼š

```
Food.select(Food.id).where(Food.uuid == uuid) # æŸ¥è¯¢æ—¶é—´ï¼š1s
```

ä¸æ¨èä½¿ç”¨ï¼š

```
# å¦‚æœæ•°æ®å­˜åœ¨ï¼Œå®ƒä¼šå°†è¯¥æ¡æ•°æ®çš„æ‰€æœ‰å­—æ®µä¿¡æ¯éƒ½ä¼šåŠ è½½ï¼Œæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œéå¸¸è€—æ—¶ã€è€—èµ„æº
Food.select().where(Food.uuid == uuid)  # æŸ¥è¯¢æ—¶é—´ï¼š3s
```

æ³¨ï¼š

1. æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Œå°±è·å–ä»€ä¹ˆ
2. åªå•å†™ä»¥ä¸Šä¸¤å¥å¹¶ä¸ä¼šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼ˆå½“é‡åˆ° forã€ifç­‰æ‰ä¼šå»æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼‰

## 2019-04-07 å­—ç¬¦ä¸²ç›¸ä¼¼åº¦æ¯”è¾ƒ 

`from difflib import SequenceMatcher`
`def similarity(a, b):`
`     return SequenceMatcher(None, a, b).ratio()`



## 2019-03-28

### python mac å¯ç”¨å¤šè¿›ç¨‹æŠ¥é”™è§£å†³åŠæ³•

å‚è€ƒé“¾æ¥ï¼š
https://www.jianshu.com/p/e62e17c137cb
https://stackoverflow.com/questions/50168647/multiprocessing-causes-python-to-crash-and-gives-an-error-may-have-been-in-progr

é”™è¯¯ä¿¡æ¯ï¼š

```
`objc[27880]: +[__NSPlaceholderDate initialize] may have been in progress in another thread when fork() was called
`may have been in progress in another thread when fork() was called``
```

è§£å†³æ–¹æ³•1:
OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
[Image: WechatIMG194.jpeg]
è§£å†³æ–¹æ³•2:
terminal 

```
`cd ~
sudo vim .bash_profile`
```

åœ¨æœ€åä¸€è¡Œæ·»åŠ ï¼š

```
`export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES`
```



## 2019-02-25

### æ„Ÿè°¢é¾™å“¥ğŸ‰

å‡€èµ„äº§è¯„ä¼°ä»·å€¼ = æ€»èµ„äº§è¯„ä¼°ä»·å€¼ - æ€»è´Ÿå€ºè¯„ä¼°ä»·å€¼
å¢å€¼ç‡ = ï¼ˆå‡€èµ„äº§è¯„ä¼°ä»·å€¼ - å‡€èµ„äº§è´¦é¢ä»·å€¼ï¼‰/ å‡€èµ„äº§è´¦é¢ä»·å€¼


## 2019-02-19

### æ„Ÿè°¢é¾™å“¥ğŸ‰

### è‚¡æƒè½¬è®©çš„ä»˜æ¬¾æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ

é“¾æ¥ï¼šhttp://www.64365.com/zs/751591.aspx
å› æ­¤ï¼ŒæŒ‰ç…§æœ‰å…³è§„å®šï¼Œè‚¡æƒè½¬è®©çš„ä»˜æ¬¾æ–¹å¼æœ‰ä¸‰ç§ï¼Œå¯ä»¥ä»¥ç°é‡‘ã€èµ„äº§æ”¯ä»˜ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–è‚¡æƒæ”¯ä»˜ã€‚ 


## 2019-02-15

gitä¸­æœç´¢

### ä»å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ä¸­æŸ¥æ‰¾æ–‡æœ¬å†…å®¹ï¼š

```
`$ git grep "sum"`
```

### åœ¨æŸä¸€ç‰ˆæœ¬ä¸­æœç´¢æ–‡æœ¬ï¼š

```
`$ git grep "Hello" v1.0`
```

## 2019-02-01

## é—®é¢˜1

æå–å­—æ®µä¸­å­˜åœ¨    â€œä¸ºâ€ä½œè°“è¯

`?<!     å’Œ    ?!`  å‚è€ƒ [2019-01-20 æ­£åˆ™è¡¨è¾¾å¼](https://hujialou.quip.com/dRdmA74Lasnr)

```
REGEX_SNIPS = {
    # 'ä¸º'ä½œè°“è¯    
    'wei': '(?<![ï¼Œï¼šè¾ƒå°†æ›´ä½œè§†éƒ½äº’æˆåˆ†])ä¸º(?![å‡†ä¾‹ä¸»])',
    }
re.compile('ä¾›åº”å•†(%(wei)s)(?P<supplier>.*)' % REGEX_SNIPS)
```



## 2019-01-29

## é—®é¢˜1

æ„Ÿè°¢é¾™å“¥çš„è§£ç­”

å‚è€ƒé“¾æ¥ï¼šhttps://wiki.mbalib.com/wiki/%E8%82%A1%E7%A5%A8%E6%8A%95%E8%B5%84%E6%94%B6%E7%9B%8A

## ä»€ä¹ˆæ˜¯è‚¡ç¥¨æŠ•èµ„æ”¶ç›Šï¼Ÿ

 è‚¡ç¥¨æŠ•èµ„æ”¶ç›Šæ˜¯æŒ‡[ä¼ä¸š](https://wiki.mbalib.com/wiki/%E4%BC%81%E4%B8%9A)ä»¥è´­ä¹°è‚¡ç¥¨çš„å½¢å¼[å¯¹å¤–æŠ•èµ„](https://wiki.mbalib.com/wiki/%E5%AF%B9%E5%A4%96%E6%8A%95%E8%B5%84)å–å¾—çš„[è‚¡åˆ©](https://wiki.mbalib.com/wiki/%E8%82%A1%E5%88%A9)ï¼Œè½¬è®©ã€å‡ºå”®è‚¡ç¥¨å–å¾—æ¬¾é¡¹é«˜äºè‚¡ç¥¨å¸é¢[å®é™…æˆæœ¬](https://wiki.mbalib.com/wiki/%E5%AE%9E%E9%99%85%E6%88%90%E6%9C%AC)çš„å·®é¢ï¼Œ[è‚¡æƒæŠ•èµ„](https://wiki.mbalib.com/wiki/%E8%82%A1%E6%9D%83%E6%8A%95%E8%B5%84)åœ¨è¢«æŠ•èµ„å•ä½å¢åŠ çš„[å‡€èµ„äº§](https://wiki.mbalib.com/wiki/%E5%87%80%E8%B5%84%E4%BA%A7)ä¸­æ‰€æ‹¥æœ‰çš„æ•°é¢ç­‰ã€‚

## é—®é¢˜2

## è¯åˆ¸ä»£ç åŒºåˆ†

6ï¼šæ²ªä¸»æ¿
0ï¼šæ·±ä¸»æ¿ã€ä¸­å°æ¿
3ï¼šæ·±åˆ›ä¸šæ¿



## 2019-01-23 

## é—®é¢˜1

## æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ­£/åå‘é¢„æŸ¥

### 1ã€æ­£å‘é¢„æŸ¥

1. (?:pattern) åŒ¹é…ç»“æœã€‚**python(?:6|7)**ç­‰æ•ˆäº**Java6|Java7**ï¼Œç»“æœ**python6** **python**7
2. (?=pattern) æ­£å‘åŒ¹é…ã€‚**python****(?=6)**ï¼ŒåŒ¹é…åé¢è·Ÿç€6çš„**python**ï¼Œå³ç¬¬ä¸€ä¸ª**python**ï¼Œç»“æœ**python**6 **python**7
3. (?!pattern) æ­£å‘ä¸åŒ¹é…ã€‚**python****(?!6)**ï¼ŒåŒ¹é…åé¢ä¸è·Ÿç€6çš„**python**ï¼Œå³ç¬¬äºŒä¸ª**python**ï¼Œç»“æœ**python**6 **python**7

### 2ã€åå‘é¢„æŸ¥

1. (?<=pattern) åå‘åŒ¹é…ã€‚**(?<=J)a**ï¼ŒåŒ¹é…ç´§è·Ÿå­—æ¯Jåé¢çš„aï¼Œç»“æœJava6 Java7
2. (?<!pattern) åå‘ä¸åŒ¹é…ã€‚**(?<!J)a**ï¼Œä¸åŒ¹é…ç´§è·Ÿå­—æ¯Jåé¢çš„aï¼Œç»“æœJava6 Java7



## 2019-01-17

## é—®é¢˜1

## é€’å½’ä¸‹è½½ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶

æ„Ÿè°¢çˆ½å“¥

```
wget -r -np -nH -R index.html http://url/including/files/you/want/to/download/
å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š
-r : éå†æ‰€æœ‰å­ç›®å½•
-np : ä¸åˆ°ä¸Šä¸€å±‚å­ç›®å½•å»
-nH : ä¸è¦å°†æ–‡ä»¶ä¿å­˜åˆ°ä¸»æœºåæ–‡ä»¶å¤¹
-R index.html : ä¸ä¸‹è½½ index.html æ–‡ä»¶
```



## 2019-01-15 

## é—®é¢˜1

### git statshæ—¶--->fatal: git-write-tree: error building trees

å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/5483213/fatal-git-write-tree-error-building-trees
https://stackoverflow.com/a/16056225/10267639

è§£å†³æ–¹æ³•ï¼š

```
git reset --mixed
instead of git reset --hard. You will not lose any changes.
```

[Image: image.png]
## é—®é¢˜2

### Djangoä¸­å¤åˆ¶/å…‹éš†ä¸€ä¸ªæ¨¡å‹çš„å®ä¾‹(Copying model instances[Â¶](https://docs.djangoproject.com/en/2.1/topics/db/queries/#copying-model-instances))

å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/en/2.1/topics/db/queries/#copying-model-instances

```
blog = Blog(name='lin', company='memect')
blog.save() # blog.pk = 1 

blog.pk = None
blog.save() # blog.pk = 2
```



## 2019-01-14 

### `<_sre.SRE_Match object; span=(0, 3), match='abc'>`å¯¹è±¡ï¼ŒspanæŒ‡çš„æ˜¯åŒ¹é…åˆ°çš„å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ä¸‹æ ‡ï¼Œåˆ†åˆ«å¯¹åº”startå’Œend

eg:

```
for para_num, para in enumerate(paragraphs):
    match = None 
    for prefix in cls._detail_patterns:
        match = prefix.search(para)
        if match:
            break 
    if match:
        if metch.end() == len(para):
            if para_ix + 1 < len(paragraphs)ï¼š# åˆ¤æ–­å½“å‰åŒ¹é…çš„ä½ç½®æ˜¯å¦æ˜¯æœ€åä¸€æ®µ
                detail = paragraphs[para_ix] 
        else:
            # å¦åˆ™å½“å‰æ®µè½çš„å‰©ä½™éƒ¨åˆ†æ˜¯æè¿°
            detail = para[match.end():]
            is_match_in_para = True 
        # æ‰¾åˆ°ç›®æ ‡ï¼Œè·³å‡ºå¾ªç¯
        break
```





## 2019-01-12

## groupdict() è¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ‰€æœ‰å‘½åçš„åŒ¹é…å­ç»„ï¼Œé”®å€¼æ˜¯å­ç»„åã€‚

```
>>> m = re.match(r'(?P<user>\w+)@(?P<comp>\w+)\.(?P<extension>\w+)','xql@me.com')
>>> m.groupdict()
{'comp': 'lin', 'user': 'xql', 'extension': 'com'}
```



## reversedï¼ˆï¼‰ä¸æ”¹å˜åŸå¯¹è±¡;åªåœ¨ç¬¬ä¸€æ¬¡éå†æ—¶è¿”å›å€¼

```
l=[1,2,3,4,5]
res =reversed(l)
l
[1, 2, 3, 4, 5]
res
<listreverseiterator object at 0x06A9E930>
for i in res:#ç¬¬ä¸€æ¬¡éå†
...     print(i),
... 
5 4 3 2 1
```

## 2019-01-10 

## super()

æœªæ•´ç†
MRO å°±æ˜¯ç±»çš„æ–¹æ³•è§£æé¡ºåºè¡¨, å…¶å®ä¹Ÿå°±æ˜¯ç»§æ‰¿çˆ¶ç±»æ–¹æ³•æ—¶çš„é¡ºåºè¡¨ã€‚

```
class FooParent(object):
    def __init__(self):
        self.parent = 'I\'m the parent.'
        print ('Parent')
    
    def bar(self,message):
        print ("%s from Parent" % message)
 
class FooChild(FooParent):
    def __init__(self):
        # super(FooChild,self) é¦–å…ˆæ‰¾åˆ° FooChild çš„çˆ¶ç±»ï¼ˆå°±æ˜¯ç±» FooParentï¼‰ï¼Œç„¶åæŠŠç±»Bçš„å¯¹è±¡ FooChild è½¬æ¢ä¸ºç±» FooParent çš„å¯¹è±¡
        super(FooChild,self).__init__()    
        print ('Child')
        
    def bar(self,message):
        super(FooChild, self).bar(message)
        print ('Child bar fuction')
        print (self.parent)
 
if __name__ == '__main__':
    fooChild = FooChild()
    fooChild.bar('HelloWorld')
```



## 2019-01-08

## é—®é¢˜1:

å‚è€ƒé“¾æ¥ï¼šhttps://dba.stackexchange.com/questions/75214/postgresql-not-running-on-mac

### PostgreSQL not running on Mac 

```
`$ brew services stop postgresql
$ rm /usr/local/var/postgres/postmaster.pid # adjust path accordingly to your install
$ brew services start postgresql`
```


[Image: image.png]PostgresSQLçš„ä¸»è¿›ç¨‹æ˜¯Postmasterï¼Œå½“å¯åŠ¨PostgresSQLåï¼Œä¼šåœ¨PostgreSQLä¸­çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ç”Ÿäº§ä¸€ä¸ª`postmaster.pid`çš„æ–‡ä»¶ã€‚
postmaster.pidçš„å†…å®¹ï¼šhttps://blog.csdn.net/xzwspy/article/details/80724944

## é—®é¢˜2

## os.path ã€[os.work](http://os.work/) 

```
__file__ï¼š å½“å‰æ–‡ä»¶æ‰€åœ¨è·¯å¾„

# è·å–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
os.path.realpath(__file__)
 
# è¿”å›å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„,ç›¸å½“äº os.path.split(path)çš„ç¬¬ä¸€ä¸ªå…ƒç´  
os.path.dirname(os.path.realpath(__file__))
```

```
>>> os.path.dirname(os.path.realpath(os.getcwd()))
'/Users/xiaoqinglin-guanliyuan/PycharmProjects/company_project'

>>> os.path.split(os.getcwd())
('/Users/xiaoqinglin-guanliyuan/PycharmProjects/company_project', 'MemectExtractor')

```

**os.walk(top, topdown=True, onerror=None, followlinks=False)**

é€’å½’æ–¹å¼è‡ªé¡¶å‘ä¸‹æˆ–è€…è‡ªåº•å‘ä¸Šçš„æ–¹å¼éå†ç›®å½•æ ‘ï¼Œå¯¹æ¯ä¸€ä¸ªç›®å½•éƒ½è¿”å›ä¸€ä¸ªä¸‰å…ƒå…ƒç»„(dirpath, dirnames, filenames)ã€‚

**ä¸‰å…ƒå…ƒç»„(dirpath, dirnames, filenames)**

1. dirpath - éå†æ‰€åœ¨ç›®å½•æ ‘çš„ä½ç½®ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡
2. dirnames - ç›®å½•æ ‘ä¸­çš„å­ç›®å½•ç»„æˆçš„åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬("."å’Œ"..")
3. filenames - ç›®å½•æ ‘ä¸­çš„æ–‡ä»¶ç»„æˆçš„åˆ—è¡¨

```
>>> type(os.walk('/Users/xiaoqinglin-guanliyuan/PycharmProjects/company_project/MemectExtractor/extractors/template'))
<class 'generator'> # è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡
```

## 

## 2019-01-07

## åˆ†æ”¯æ›¿æ¢

å‚è€ƒé“¾æ¥ï¼š
https://gitlab.com/zbjdonald/personal-wiki/blob/master/Git.md
https://stackoverflow.com/a/2862606/10267639
https://github.com/LeachZhou/blog/issues/11
[https://gitbook.tw/chapters/](https://gitbook.tw/chapters/github/using-force-push.html)
[hub/using-force-push.html](https://gitbook.tw/chapters/github/using-force-push.html)

å°†developeråˆ†æ”¯ç”¨masteråˆ†ä¹‹å®Œå…¨æ›¿æ¢

```
`git branch -m developer old-developer
git branch -m master developer 
git push -f origin developer 
# remote: GitLab: You are not allowed to force push code to a protected branch on this project.
# To http://git.xxx.cn/xxx/xxx
#  ! [remote rejected] master -> master (pre-receive hook declined)
# error: failed to push some refs to 'http://xxx@git.xxx.cn/xxx/xxx.git'`
```


**gitlab â†’ settings  â†’Repository â†’ Protected Branches**

[Image: image.png]å—ä¿æŠ¤çš„åˆ†æ”¯ä¸å…è®¸è¿›è¡Œå¼ºåˆ¶æ¨é€ï¼Œè§£é™¤æ‰å—ä¿æŠ¤çš„åˆ†æ”¯å³å¯ï¼ŒUnProtectè§£é™¤ä¿æŠ¤ï¼Œç„¶åå†æ¬¡è¿›è¡Œå¼ºåˆ¶æ¨é€å‘½ä»¤
`$ git push origin developer -f`ã€‚
æ¨å®Œä¹‹åå†å›åˆ°è¿™é‡Œè¿›è¡Œé‡æ–°ä¿æŠ¤masteråˆ†æ”¯ï¼Œé€‰æ‹©åˆ†æ”¯ï¼Œç‚¹å‡»Protectå³å¯
[Image: image.png]

## 2019-01-04

## é—®é¢˜1

## Datagripä¸­è¿è¡Œsqlè¯­å¥

[Image: image.png]
### ORMç”Ÿæˆçš„sqlè¯­å¥ï¼š

```
SELECT "exports_exports"."fold_amount" 
FROM "exports_exports" 
WHERE (("exports_exports"."cargo_unit_name" = æ–¯æŸåŒ–å·¥(ä¸Šæµ·)æœ‰é™å…¬å¸ OR "exports_exports"."business_unit_name" = æ–¯æŸåŒ–å·¥(ä¸Šæµ·)æœ‰é™å…¬å¸) AND "exports_exports"."export_date" 
BETWEEN 2018-01-01 AND 2018-12-31)
 ORDER BY "exports_exports"."export_date" DESC
```

## é—®é¢˜2

## django ORMä¸­filterçš„å‘

### å‚è€ƒé“¾æ¥ï¼š

http://www.liujiangblog.com/course/django/129
https://docs.djangoproject.com/zh-hans/2.1/topics/db/queries/#chaining-filters

```
# andçš„å…³ç³»
Users.objects.filter(name=name1, date=date1) 
```

å’Œ

```
# orçš„å…³ç³»
Users.objects.filter(name=name1).filter(date=date1) 
```

## é—®é¢˜2

## å¯¹querysetè¿›è¡Œæ’åº

```
[<TechnicalRegistration: TechnicalRegistration object (PD20142644)>,
<TechnicalRegistration: TechnicalRegistration object (PD20141369)>]
```

```
from operator import attrgetter
sorted(querylist, key=attrgetter("**id**")
```



## 2019-01-02

## é—®é¢˜1

## djangoä¸­æ‰¹é‡åˆ é™¤redisæ•°æ®åº“ä¸­çš„ç¼“å­˜æ•°æ®

```
from django_redis import get_redis_connection
>>> conn = get_redis_connection('foreground_exports_detail')
```

```
# è·å–æ‰€æœ‰çš„ç¼“å­˜æ•°æ®çš„key
for i in conn.keys("*"):
...     print(i.decode('utf-8'))
```

```
# åˆ é™¤ç¼“å­˜æ•°æ®
for i in conn.keys("**_**year**_export"):*
*...     print(conn.delete(i))** *
*1*
*1*
*1*
```

## é—®é¢˜2 

## å‘é€éªŒè¯ç ã€æ›´æ–°å¯†ç ç­‰æ¥å£çš„æƒé™è®¾ç½®

è®¾ç½®å®Œæˆä»¥åï¼Œåœ¨ä»£ç é‡Œéœ€`éªŒè¯é‚®ç®±(serializers---> ***validate_email***)`æ˜¯å¦å·²ç»æ³¨å†Œï¼Œæ³¨å†Œåˆ™å‘é€éªŒè¯ç ,å¦åˆ™ä¸å‘é€

```
class ...Viewset(mixins.CreateModelMixin, viewsets.GenericViewSet):
    permission_classes = (AllowAny,)
    
    
```



## 2019-01-01

## é—®é¢˜1 

## django orm list to queryset 

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/4790371/10267639

```
exports_query = Exports.objects.filter(pk__in=[x.pk ***for ***x ***in ***export_objs])
```



## é—®é¢˜2

## æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

```
`# åªéœ€æå–åŒ¹é…ç™¾åˆ†æ•°
re.findall(r'(\d{0,2}(\.\d{1,2})?%)', 'ä¸­å›½90%çš„åŸå¸‚80.5%')`
`[('90%', ''), ('80.5%', '.5')]`
```

ä¿®æ”¹

```
>>> re.findall(r'(\d{0,2}(?:\.\d{1,2})?%)', 'ä¸­å›½90%çš„åŸå¸‚80.5%')
['90%', '80.5%']
```

[Image: image.png]

## 2018-10-10

## **é—®é¢˜1: **

### **How to remove items from a list while iterating?**

å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/1207406/how-to-remove-items-from-a-list-while-iterating
https://stackoverflow.com/a/1208792
åˆ—è¡¨ä¸­å«æœ‰å­—å…¸ï¼š

```
somelist[:] = [x for x in somelist if not determine(x)]
somelist[:] = [x for x in somelist if determine(x)]
```



## **é—®é¢˜2: **

### **How to check if any value is NaN in a Pandas DataFrame**

### **Use None instead of np.nan for null values in pandas DataFrame**

å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/29530232/how-to-check-if-any-value-is-nan-in-a-pandas-dataframe
https://stackoverflow.com/questions/39279824/use-none-instead-of-np-nan-for-null-values-in-pandas-dataframe
http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.where.html

```
df.where(df.notnull(), None)
```



## **é—®é¢˜3:**

### **Filtering against query parameters**

å‚è€ƒé“¾æ¥ï¼š
https://www.django-rest-framework.org/api-guide/filtering/#filtering-against-query-parameters

å‚è€ƒé“¾æ¥ï¼š

```
class CustomsList(generics.ListAPIView):
    serializer_class = CustomsSerializer

    def get_queryset(self):
        queryset = Customs.objects.all()
        name = self.request.query_params.get('name', None)
        if username is not None:
            queryset = queryset.filter(technical__name=name)
        return queryset
# æœç´¢é“¾æ¥ ï¼ˆæ³¨ï¼šæœ€åä¸èƒ½æ·»åŠ â€œ/â€ï¼‰
http://example.com/api/customs/?name="è‰ç”˜è†¦" 
```



## é—®é¢˜4: 

### **How to get the parent dir location **

### **os.path è·å–**

é—®é¢˜æœç´¢å…³é”®å­—ï¼š python file path Parent 
https://simpleisbetterthancomplex.com/tutorial/2018/08/27/how-to-create-custom-django-management-commands.html
[How to get the parent dir location](https://stackoverflow.com/questions/2817264/how-to-get-the-parent-dir-location)
[Get parent of current directory from Python script](https://stackoverflow.com/questions/30218802/get-parent-of-current-directory-from-python-script)
os.path.join å°†å¤šä¸ªè·¯å¾„ç»„åˆåè¿”å›ï¼Œç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„ä¹‹å‰çš„å‚æ•°å°†è¢«å¿½ç•¥
os.path.dirname è¿”å›pathçš„ç›®å½•ã€‚å…¶å®å°±æ˜¯`os.path.split(path)`çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

```
path = os.path.join(os.path.dirname(__file__), os.path.join('templates', 'blog1/page.html'))
aParent
   |--a
   |  |---b.py
   |      |---templates
   |              |--------blog1
   |                         |-------page.html
   |--templates
          |--------blog1
                     |-------page.html
```


how to get the a Parent location:

```
dirname = os.path.dirname 
path = os.path.join(dirname(dirname(__file__)), os.path.join('templated', 'blog1/page.html'))
```


or

```
path = os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))
import os
current_dir =  os.path.abspath(os.path.dirname(__file__))
parent_dir = os.path.abspath(current_dir + "/../")
path = os.path.abspath(os.path.join(os.path.dirname(os.path.abspath(__file__)),"..",".."))
```




## **2018-10-11 **

## é—®é¢˜1:

### è·å–è¢«å…³è”æ¨¡å‹ä¸­çš„ä¸€ä¸ªå¯¹è±¡


æœç´¢å…³é”®è¯ï¼što_representation override 
å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/a/31821891/10267639

### **https://www.django-rest-framework.org/api-guide/serializers/#creating-new-base-classes**

githubä¸Šçš„example:
https://github.com/manueljrr/mafia/blob/8cfb83c896574e7cd869302802f294c22c510b52/app/serializers.py

```
def to_representation(self, instance):
    data = super(IntermediateListSerializer, self).to_representation(instance)
    interdiateprice = instance.intermediateprice.all().first()
    data['price'] = interdiateprice.price
    data['date'] = interdiateprice.date
    return data
```



## é—®é¢˜2:

### é€šè¿‡APIè¿”å›ä¸€ä¸ªexcelæ¨¡æ¿æ–‡ä»¶


æœç´¢å…³é”®å­—ï¼š
å‚è€ƒé“¾æ¥ï¼š
https://xlsxwriter.readthedocs.io/working_with_pandas.html
https://stackoverflow.com/a/50686105/10267639

```
def get(self, request):
    df = pd.DataFrame({"æ—¶é—´": [], "ä¸­é—´ä½“åç§°": [], "å½“æœŸä»·æ ¼": [], "å®ç‰©/æŠ˜ç™¾": []})
    excel_file = BytesIO()
    writer = pd.ExcelWriter(excel_file, engine='xlsxwriter')
    df.to_excel(writer, sheet_name="Sheet1", na_rep=None, startcol=-1)
    writer.save()
    writer.close()
    excel_file.seek(0)
    response = HttpResponse(excel_file.read(),
                            content_type='application/vnd.ms-excel')
    response['Content-Disposition'] = 'attachment; filename="Intermediate.xlsx"'
    return response
```



## é—®é¢˜3:

### è®¾ç½®å¯¼å‡ºexcelæ–‡ä»¶çš„æ ·å¼


æœç´¢å…³é”®è¯ï¼špandas xlsxwriter excel set_row

å‚è€ƒé“¾æ¥ï¼š
https://xlsxwriter.readthedocs.io/worksheet.html

å¸¸ç”¨æ ¼å¼ï¼š

* å­—ä½“é¢œè‰²ï¼šcolor
* å­—ä½“åŠ ç²—ï¼šbold
* å­—ä½“å¤§å°ï¼šfont_site
* æ—¥æœŸæ ¼å¼ï¼šnum_format
* è¶…é“¾æ¥ï¼šurl
* ä¸‹åˆ’çº¿è®¾ç½®ï¼šunderline
* å•å…ƒæ ¼é¢œè‰²ï¼šbg_color
* è¾¹æ¡†ï¼šborder
* å¯¹é½æ–¹å¼ï¼šalign

```

        workbook = writer.book
        font_fmt = workbook.add_format({'font_name': 'Arial', 'font_size': 18, 'align': 'center'})
        header_fmt = workbook.add_format({'font_name': 'Arial', 'font_size': 18, 'bold': True, 'align': 'center'})
        # è®¾ç½®A-Zçš„åˆ—å®½
        worksheet.set_column('A:D', 30, font_fmt)
        # è®¾ç½®1-20è¡Œçš„è¡Œé«˜
        for i in range(1, 21):
            worksheet.set_row(i, 30, font_fmt)
```



## 2018-10-15

## é—®é¢˜1:

### django scripts run é…ç½®

1.æ–°å»ºä¸€ä¸ªpackageçš„åŒ…scripts 
[Image: Image.jpg]

2.é…ç½®è¿è¡Œç¯å¢ƒ
[Image: Image.jpg]

## é—®é¢˜2:

### migrations.pyå’Œmodelä¸å¯¹åº”

[Image: image.png]
## 2018-10-16

## é—®é¢˜1:

### æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®å·²ç»å­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º


æœç´¢å…³é”®è¯ï¼š djagno update_or_create
å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/zh-hans/2.1/ref/models/querysets/#update-or-create 

```
# ä»£ç å®ç°
defaults = {'first_name': 'Bob'}
try:
    obj = Person.objects.get(first_name='John', last_name='Lennon')
    for key, value in defaults.items():
        setattr(obj, key, value)
    obj.save()
except Person.DoesNotExist:
    new_values = {'first_name': 'John', 'last_name': 'Lennon'}
    new_values.update(defaults)
    obj = Person(**new_values)
    obj.save()
```

ä¸Šé¢çš„æ–¹æ³•éšç€æ¨¡å‹ä¸­å­—æ®µæ•°é‡çš„å¢åŠ ï¼Œè¿™ç§æ¨¡å¼å˜å¾—ç›¸å½“ç¬¨æ‹™
ä½¿ç”¨ `**`update_or_create()`**` è¿›è¡Œç®€åŒ–:

```
obj, created = Person.objects.update_or_create(first_name='John', 
            last_name='Lennon',defaults={'first_name': 'Bob'},)
```



## é—®é¢˜2:

### datetime <=> date

datetime -> date

```

>>> **import** _datetime
_>>> datetime.now().date()
datetime.date(2018, 1**0**, 16)
```


date -> datetime

```

>>> datetime.date.today()
datetime.date(2018, 10, 16)
>>> today = datetime.date.today()
>>> datetime.datetime.combine(today, datetime.time())
datetime.datetime(2018, 10, 16, 0, 0)
>>> datetime.datetime.combine(today, datetime.time.min)
datetime.datetime(2018, 10, 16, 0, 0)
```



## é—®é¢˜3:

### éœ€è¦åµŒå¥—è¿”å›æ•°æ®ï¼Œä¸”å½“å‰éœ€è¦åºåˆ—åŒ–çš„modelä¸­æ²¡æœ‰å¤–é”®

```
class LessonSerializer(serializers.ModelSerializer):
    
    exercises = serializers.SerializerMethodField()

    class Meta:
        model = Lesson
        fields = '__all__'

    def get_exercises(self, obj):
        qs = obj.exercises.all().order_by('index')
        return ExerciseSerializer(qs, many=True, read_only=True).data
```

## 2018-10-17 

## é—®é¢˜1ï¼š

### è‡ªåŠ¨ç”Ÿæˆdjango modelçš„å…³è”å…³ç³»å›¾


å‚è€ƒé“¾æ¥ï¼š
https://bytes.vokal.io/20151026-graphing-django-models/
https://django-extensions.readthedocs.io/en/latest/graph_models.html

settings.py æ–‡ä»¶é…ç½®ï¼š
`pipenv intall django-extensions pygraphviz`

```
`INSTALLED_APPS = (
    'django_extensions',
    ...
)

GRAPH_MODELS = {
    'pygraphviz': **True**,
    'group_models': **True**,
    'exclude_models': 'BasePasscode, AbstractBaseUser, PermissionsMixin, Group, Permission'
}`
```


`$ ./manage.py graph_models -o db_graph.png app_name1 app_name2 app_name3 app_name4 `

macå®‰è£… pygraphvizä¸èƒ½å®‰è£…ä¸Š:
é”™è¯¯ä¿¡æ¯ï¼š
[Image: Image.jpg]è§£å†³æ–¹æ³•ï¼š
å‚è€ƒé“¾æ¥ï¼šhttps://graphviz.gitlab.io/download/
`brew install graphviz
brew install graphviz-devel
pipenv install pygraphviz --dev`

[Image: Image.jpg][Image: Image.jpg]

## é—®é¢˜2:

### å°†å·²ç»commitçš„æ–‡ä»¶æ”¹ä¸ºUntrack file 


æŸ¥è¯¢å…³é”®è¯ï¼šgit change a commit file untracked

å‚è€ƒé“¾æ¥ï¼šhttps://kimsereyblog.blogspot.com/2016/09/untrack-file-previously-pushed-with-git.html

```
`(qiaochang-ZI9x__ny) âœ qiaochang git:(feature/intermediate_model) âœ— git ls-tree -r developer
100644 blob 4b9b114a72c1d8d14d0e0c22200952ef18cf2fa0 .env.example 
100644 blob 17058d3d0f62fd17f3a555efdd7dfb30e8f771d1 .gitignore 
100644 blob 32070de6135ce85702269302125d229105eff42f Pipfile
100644 blob 92efd471225f264e353a4b8e30d818a14632298b Pipfile.lock

(qiaochang-ZI9x__ny) âœ  qiaochang git:(feature/`intermediate_model`) âœ— git rm --cached qiaochang/users/migrations/0001_initial.py 
rm 'qiaochang/users/migrations/0001_initial.py'

(qiaochang-ZI9x__ny) âœ  qiaochang git:(feature/`intermediate_model`) âœ— git rm --cached qiaochang/exports/migrations/0001_initial.py 
rm 'qiaochang/exports/migrations/0001_initial.py'

(qiaochang-ZI9x__ny) âœ  qiaochang git:(feature/`intermediate_model`) âœ— git commit -m "remove exports/migrations/0001_initial.py users`/migrations/0001_initial.py`"
[feature/change_intermediate_technical_model 4f149f4] remove usersã€exports 0001â€”â€”initial.py
 2 files changed, 140 deletions(-)
 delete mode 100644 qiaochang/exports/migrations/0001_initial.py
 delete mode 100644 qiaochang/users/migrations/0001_initial.py

(qiaochang-ZI9x__ny) âœ  qiaochang git:(feature/`intermediate_model`) âœ— git push 
Enter passphrase for key '/Users/xiaoqinglin-guanliyuan/.ssh/id_rsa': 
Enumerating objects: 9, done.
Counting objects: 100% (9/9), done.
Delta compression using up to 8 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 487 bytes | 487.00 KiB/s, done.`
```

## 2018-10-18

## é—®é¢˜1ï¼š

### django+pandas ç”Ÿæˆçš„excelæ–‡ä»¶åä¸ºä¸­æ–‡


æŸ¥è¯¢å…³é”®å­—ï¼šdjango download file name chinese

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/questions/9531067/downloading-a-file-with-chinese-characters-in-the-name-in-django-with-httprespon

```
`Chromeæµè§ˆå™¨ï¼Œé‡‡ç”¨**Base64ç¼–ç æˆ–ISOç¼–ç çš„ä¸­æ–‡è¾“å‡º
**FireFoxæµè§ˆå™¨ï¼Œé‡‡ç”¨**Base64æˆ–filename*æˆ–ISOç¼–ç çš„ä¸­æ–‡è¾“å‡º**`
```



```
***from ***django.utils.encoding ***import ***escape_uri_path
def upload_template_excel(header, file_name):
    """excelä¸Šä¼ æ¨¡æ¿"""
    df = pd.DataFrame(columns=header)
    excel_file = BytesIO()
    writer = pd.ExcelWriter(excel_file, engine='xlsxwriter')
    df.to_excel(writer, sheet_name="Sheet1", na_rep=None, startcol=-1)
    response = HttpResponse(excel_file.read(), content_type='application/vnd.ms-excel')
    # éœ€è¦è¿›è¡Œ
    response['Content-Disposition'] = "attachment; filename*=utf-8''{}".format(escape_uri_path(file_name))
    return response
```


**`escape_uri_path`(*path*)[**[source]**](https://docs.djangoproject.com/en/2.1/_modules/django/utils/encoding/#escape_uri_path)**

Escapes the unsafe characters from the path portion of a Uniform Resource Identifier (URI).

## é—®é¢˜2:

å°†æ•´æ•°è½¬ä¸ºexcelçš„åˆ—å­—æ¯ï¼š

### 

æŸ¥è¯¢å…³é”®è¯ï¼šexcel numbers to columns python

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/questions/23861680/convert-spreadsheet-number-to-column-letter

```
def col_range(max_col_num, start_col_label="A"):
    """
    ç”Ÿæˆcolumns("A:AB")
    :param max_col_num:æœ€å¤§åˆ—æ•°å­—
    :param start_col_label: èµ·å§‹åˆ—æ•°å­—
    :return: "A:Z" or "A:AA"
    """
    col_letter = num_to_col_label(max_col_num)
    return "{start}:{end}".format(start=start_col_label, end=col_letter)

def num_to_col_letters(num):
    """
    å°†æ•°å­—è½¬ä¸ºexcelä¸­çš„æœ€å¤§åˆ—å­—æ¯
    1-> A
    27 -> AA
    """
    letters = ''
    while num:
        mod = (num - 1) % 26
        letters += chr(mod + 65)
        num = (num - 1) // 26
    return ''.join(reversed(letters))


```

å°†åˆ—å­—æ¯è½¬ä¸ºæ•°å­—ï¼š
å‚è€ƒé“¾æ¥ï¼šhttp://pythonfiddle.com/leetcode171-excel-sheet-column-number/

```
class Solution():
    def col_letters_to_num(self, s):
        """
        :type s: str
        :rtype: int
        """
        s = s.upper()
        LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        maps = {}
        for i in range(26):
            maps[LETTERS[i]] = i+ 1
            
        col = 0 
        for l in s:
            col = 26*col + maps[l]
        
        return col
```

## 2018-10-19 

## é—®é¢˜1:

### APIViewä¸GenericAPIViewçš„åŒºåˆ«


å‚çœ‹é“¾æ¥ï¼š
[Rewriting our API using class-based views](https://www.django-rest-framework.org/tutorial/3-class-based-views/#rewriting-our-api-using-class-based-views)
APIView:https://www.django-rest-framework.org/api-guide/views/
GenericApiView:https://www.django-rest-framework.org/api-guide/generic-views/#genericapiview

APIView:
APIViewæ˜¯djangoä¸­Viewçš„å­ç±»:
ä½¿ç”¨APIViewæ—¶ï¼Œæ¥æ”¶çš„è¯·æ±‚ä¼šè¢«dispatchåˆ°å¯¹åº”çš„æ–¹æ³•ä¸­ï¼Œå¦‚`get()ã€``post() ã€put()ã€patch()ã€delete()`
[Image: Image.jpg]

```
# eg:
class SnippetList(APIView):

    # å¤„ç†GETè¯·æ±‚,è°ƒç”¨äº†drfæœ¬èº«çš„serializerä»¥åŠResponseæ–¹æ³•
    def get(self, request, format=None):
        snippet = Snippet.objects.all()
        serializer = SnippetSerializer(snippet, many=True)
        return Response(serializer.data)
```

GenericView:
GenericViewæ‰©å±•äº†REST frameworkçš„APIViewç±»ï¼Œadding commonly required behavior for` standard list and detail views(é‡ç‚¹)`

Attributes:
[Image: Image.jpg]
```
from rest_framework import generics

class CourseListView(generics.GenericAPIView):
    """
     ç”¨æˆ·åˆ—è¡¨é¡µ
    """
    queryset = User.objects.all()
    serialize_class = User.Serializer

    def get(self, request, *args, **kwargs):
        pass 
```

## 2018-10-24 

## é—®é¢˜1ï¼š

### djangoä¸­ä½¿ç”¨MD5åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦ç›¸åŒ


å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/questions/16874598/how-do-i-calculate-the-md5-checksum-of-a-file-in-python
https://stackoverflow.com/questions/1072569/see-if-two-files-have-the-same-content-in-python/1072576#1072576
https://stackoverflow.com/questions/3431825/generating-an-md5-checksum-of-a-file


```
import hashlib
class GeneralImportView(APIView):

 def post(self, request):
 import_file = request.FILES['file']
 file_name = import_file.name
 upload_month = file_name.split(".")[0]
 md5_returned = cmp_hash(import_file, upload_month)


def cmp_hash(file_obj, upload_moth):
 hash1 = hashlib.md5()
 # file_obj.read() djangoä¸­å­˜åœ¨çš„æ–¹æ³•
 hash1.update(file_obj.read())
 md5_returned = hash1.hexdigest()

 customs_querys = CustomsRawData.objects.filter(date=upload_moth)
 if customs_querys:
 customs_data = customs_querys.first()
 if hash1 == customs_data.hash:
 return None
 else:
 return md5_returned
```

## 2018-10-28 

## é—®é¢˜1:

### åˆ é™¤excelè¡¨æ ¼ä¸­å…¨ä¸ºnançš„è¡Œ

### åˆ é™¤excelè¡¨ä¸­å…¨ä¸ºçš„nanè¡Œ


æŸ¥è¯¢å…³é”®è¯ï¼špandas remove rows with all nan
å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/a/27579343/10267639
https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.dropna.html

```
df.dropna(how="all")
```

é‡‡ç”¨ä½ç½®è¿›è¡Œé€‰æ‹© `iloc`, è¿ç»­é€‰æˆ–è€…è·¨è¡Œé€‰ç­‰æ“ä½œã€‚

```
df.iloc[start:end]
```



```
`print(df.iloc[3,1])
# 13
print(df.iloc[3:5,1:3])
             B   C
2013-01-04  13  14
2013-01-05  17  18
print(df.iloc[[1,3,5],1:3])
             B   C
2013-01-02   5   6
2013-01-04  13  14
2013-01-06  21  22`
```


æ’å…¥åˆ—ï¼š
https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.insert.html

```
df.insert(loc=6, column=6, value=date)
```


å¤šä¸ªdfåˆå¹¶æˆä¸€ä¸ªæ–°çš„df:
df_list = [df1, df2, df3]

```
data_frame = pd.concat(df_list)
```



## 2018-10-29

## é—®é¢˜1: 

### åˆ é™¤nançš„è¡Œåï¼Œ é‡ç½®ç´¢å¼•


æœç´¢å…³é”®è¯ï¼š
pandas reset index
pandas handle index lost
http://pandas.pydata.org/pandas-docs/version/0.16/indexing.html
https://stackoverflow.com/questions/40755680/how-to-reset-index-pandas-dataframe-after-dropna-pandas-dataframe

```
`df = df.dropna(how='any')
df = df.reset_index(drop=True)`
```



## é—®é¢˜2:

### pathlibçš„ä½¿ç”¨ï¼š

https://docs.python.org/3/library/pathlib.html
https://xin053.github.io/2016/07/03/pathlib%E8%B7%AF%E5%BE%84%E5%BA%93%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/


## 2018-10-30 

## é—®é¢˜3:

### Using python dictionaries rather than Redis for some use cases?

å‚è€ƒé“¾æ¥ï¼šhttps://forums.manning.com/posts/list/30936.page

### å®šæ—¶ä»»åŠ¡schedule

https://github.com/dbader/schedule
https://schedule.readthedocs.io/en/stable/

```
import schedule
import time


def job():
    print('I am working')


schedule.every(10).minutes.do(job)
schedule.every(3).seconds.do(job)
schedule.every().hour.do(job)
schedule.every().day.at('11:30').do(job)
schedule.every().monday.do(job)
schedule.every().wednesday.at("13:15").do(job)

while True:
    schedule.run_pending()
    time.sleep(1)
```

```
/Users/xiaoqinglin-guanliyuan/.local/share/virtualenvs/qiaochang-ZI9x__ny/bin/python /Users/xiaoqinglin-guanliyuan/PycharmProjects/qiaochang/qiaochang/technical/scripts/schedule_demo.py
I am working
I am working
I am working
I am working
I am working
I am working
I am working
```


http://docs.python-requests.org/zh_CN/latest/user/quickstart.html

## 2018-11-1 

## é—®é¢˜1ï¼š

### django orm  values_listçš„ä½¿ç”¨ï¼Œflatå‚æ•° 

https://docs.djangoproject.com/en/2.1/ref/models/querysets/#values-list
[Image: image.png]
## é—®é¢˜2:

### ç”¨æˆ·è‡ªå®šä¹‰è®¤è¯ï¼š

https://docs.djangoproject.com/en/2.1/ref/settings/
https://docs.djangoproject.com/zh-hans/2.1/topics/auth/customizing/


## é—®é¢˜3:

### django æ”¯æŒæ•°æ®åº“æœåŠ¡


https://docs.djangoproject.com/zh-hans/2.1/topics/db/transactions/#controlling-transactions-explicitly

```
**from** **django.db** **import** transaction

@transaction.atomic**
def** viewfunc(request):
*# This code executes inside a transaction.*do_stuff()
```



## é—®é¢˜4:

### ä½¿ç”¨ Requests å‘é€ç½‘ç»œè¯·æ±‚éå¸¸ç®€å•



```
>>> **import** requests
>>> payload = {'key1': 'value1', 'key2': 'value2'}
>>> r = requests.get("http://httpbin.org/get", params=payload)
>>> print(r.url)
http://httpbin.org/get?key1=value1&key2=value2&key2=value3
>>> r.json()
[{u'repository': {u'open_issues': 0, u'url': 'https://github.com/...
```



## 2018-11-04 

## é—®é¢˜1:

### gitä¸­çš„Fast Forwardæ¨¡å¼ï¼š

åˆå¹¶åˆ†æ”¯æ—¶ï¼ŒGitä¼šç”¨`Fast forward`æ¨¡å¼ï¼Œä½†è¯¥æ¨¡å¼ä¸‹ï¼Œåˆ é™¤åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯ä¿¡æ¯ã€‚
å¦‚æœè¦å¼ºåˆ¶ç¦ç”¨`Fast forward`æ¨¡å¼ï¼ŒGitå°±ä¼šåœ¨mergeæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„commitï¼Œè¿™æ ·ï¼Œä»åˆ†æ”¯å†å²ä¸Šå°±å¯ä»¥çœ‹å‡ºåˆ†æ”¯ä¿¡æ¯ã€‚

`ä½¿ç”¨--no-ff`æ–¹å¼å¼ºåˆ¶ç¦ç”¨Fast Forwardæ¨¡å¼

```
`git merge --no-ff -m "add Car model" feature/add_Car_model`
```


åˆå¹¶åˆ†æ”¯æ—¶ï¼ŒåŠ ä¸Š`--no-ff`å‚æ•°å°±å¯ä»¥ç”¨æ™®é€šæ¨¡å¼åˆå¹¶ï¼Œåˆå¹¶åçš„å†å²æœ‰åˆ†æ”¯ï¼Œèƒ½çœ‹å‡ºæ¥æ›¾ç»åšè¿‡çš„åˆå¹¶ï¼Œè€Œ`fast forward`åˆå¹¶å°±çœ‹ä¸å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶ã€‚

## 2018-11-05 

## é—®é¢˜1:

### pythonä¸­å¦‚ä½•è¡¨ç¤ºæ­£è´Ÿæ— ç©·

```
float("inf") # æ­£æ— ç©·
float("-inf") # è´Ÿæ— ç©·
```



## 2018-11-06

## é—®é¢˜1ï¼š 

### å­—ç¬¦ä¸²è½¬æ—¶é—´

```
import datetime 
def str_to_date(str_date):
    """å­—ç¬¦ä¸²è½¬æ—¥æœŸ"""
    date_obj = datetime.strptime(str_date, '%Y%m%d').date()
    return date_obj
```

## 2018-11-07 

## é—®é¢˜1:

### ä½¿ç”¨requestï¼Œå‘é€postè¯·æ±‚

```
payload_dict = {'key1': ['value1', 'value2']}
>>> r2 = requests.post('[https://0.0.0.0:8000/post](https://httpbin.org/post)', data=payload_dict)
```

## 2018-11-08

## é—®é¢˜1:

### æŸ¥è¯¢å…³é”®å­—ï¼š python nested dict check value 

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/questions/25833613/python-safe-method-to-get-value-of-nested-dictionary
itertoolså‚è€ƒé“¾æ¥ï¼š

```
try:
    example_dict['key1']['key2']
except KeyError:
    pass
```

```
`key2_value = (example_dict.get('key1') or {}).get('key2')`
```



## é—®é¢˜2:

### django ä¸­å¯¹querysetä¸­çš„å€¼æ±‚å’Œè®¡ç®—ï¼ˆå¯¹æŸ¥è¯¢é›†è¿›è¡Œèšåˆè¿ç®—ï¼‰


å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/zh-hans/2.1/topics/db/aggregation/

```
**>>> ****from** **django.db.models** **import** Avg, Count, Min, Sum
**>>> Technical**.objects.annotate(Sum('fold_amount'))
```



## 2018-11-12

## é—®é¢˜1ï¼š

### å¦‚ä½•é€šè¿‡æ—¥æœŸè®¡ç®—æ˜¯ç¬¬å‡ å‘¨


æŸ¥è¯¢å…³é”®è¯ï¼šhow to get  week number in python

å‚è€ƒé“¾æ¥ï¼šhttp://week-number.net/programming/week-number-in-python.html

```
`**from** datetime **import** date

weekNumber **=** date**.**today**(****)****.**isocalendar**(****)****[****1****]****print** **'Week number:'****,** weekNumber`

```




## 2018-11-13 

## é—®é¢˜1:

### å¯¹æ—¶é—´æŸ¥è¯¢é›†æŒ‰å¹´æœˆè¿›è¡Œåˆ†ç»„


itertoolæ¨¡å—å‚è€ƒé“¾æ¥ï¼šhttp://www.wklken.me/posts/2013/08/20/python-extra-itertools.html

## groupby

`groupby` ç”¨äºå¯¹åºåˆ—è¿›è¡Œåˆ†ç»„ï¼Œå®ƒçš„ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š

```
`from itertools import groupby
groupby(iterable,[ keyfunc])`
```


ä½¿ç”¨ä¹‹å‰ä¸€å®šè¦å¯¹iterableè¿›è¡Œæ’åº
å…¶ä¸­ï¼Œiterable æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œkeyfunc æ˜¯åˆ†ç»„å‡½æ•°ï¼Œç”¨äºå¯¹ iterable çš„**è¿ç»­é¡¹**è¿›è¡Œåˆ†ç»„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤å¯¹ iterable ä¸­çš„è¿ç»­ç›¸åŒé¡¹è¿›è¡Œåˆ†ç»„ï¼Œè¿”å›ä¸€ä¸ª `(key, sub-iterator)` çš„è¿­ä»£å™¨ã€‚
æ­¤å‡½æ•°è¿”å›çš„è¿­ä»£å™¨ç”Ÿæˆå…ƒç´ (key, group)ï¼Œå…¶ä¸­keyæ˜¯åˆ†ç»„çš„é”®å€¼ï¼Œgroupæ˜¯è¿­ä»£å™¨ï¼Œç”Ÿæˆç»„æˆè¯¥ç»„çš„æ‰€æœ‰é¡¹

## é—®é¢˜2ï¼š

### è·å–æ—¥æœŸåˆ—è¡¨ä¸­æœ€å¤§çš„æ—¥æœŸ


å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/a/3922666/10267639
https://docs.djangoproject.com/en/2.1/topics/db/queries/

```
from datetime import datetime

datetime_list = [
    datetime(2009, 10, 12, 10, 10),
    datetime(2010, 10, 12, 10, 10),
    datetime(2010, 10, 12, 10, 10),
    datetime(2011, 10, 12, 10, 10), #future
    datetime(2012, 10, 12, 10, 10), #future
]

print(max(datetime_list))
```

multiple times 
django orm multiple times

## é—®é¢˜3ï¼š

### django postgresä¸­ArrayFieldçš„ä½¿ç”¨


æŸ¥è¯¢é“¾æ¥ï¼š
https://django-postgres-extensions.readthedocs.io/en/latest/arrays.html

```
rom django.db import modelsfrom django_postgres_extensions.models.fields 
import ArrayField
class Product(models.Model):
    tags = ArrayField(models.CharField(max_length=15), null=True, blank=True)
    moretags = ArrayField(models.CharField(max_length=15), null=True, blank=True)
```



## é—®é¢˜4ï¼š

### django postgres ArrayField set default

[Image: image.png]å‚è€ƒé“¾æ¥ï¼š`**`ArrayField`**`
https://docs.djangoproject.com/zh-hans/2.1/ref/contrib/postgres/fields/#arrayfield

[Image: image.png]
## 2018-11-14

passphrase: n å¯†ç 
populate: å¡«å……

## é—®é¢˜1 

### django ä¸­é€šè¿‡åˆ¤æ–­ä¸€ä¸ªæ—¥æœŸæ˜¯å¦åœ¨ä¸€ä¸ªæ—¥æœŸåŒºé—´å†…è¿‡æ»¤æ•°æ®


æŸ¥è¯¢å…³é”®è¯ï¼š django orm date range

å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/zh-hans/2.1/ref/models/querysets/#range

### `**`range`**`

```
**import** **datetime
**start_date = datetime.date(2005, 1, 1)
end_date = datetime.date(2005, 3, 31)
Entry.objects.filter(pub_date__range=(start_date, end_date))
```


SQL equivalent:
` WHERE ``pub_date ``BETWEEN ``'2005-01-01' **`and`** ``'2005-03-31'``;`
You can use `**`range`**` anywhere you can use `**`BETWEEN`**` in SQL â€” for dates, numbers and even characters.
**è­¦å‘Š**

Filtering a `**`DateTimeField`**` with dates won't include items on the last day, because the bounds are interpreted as "0am on the given date". If `**`pub_date`**` was a `**`DateTimeField`**`, the above expressionï¼ˆè¡¨ç¤ºï¼‰ would be turned into this SQL:

## SELECT

`WHERE` `pub_date` `BETWEEN` `'2005-01-01 00:00:00'` **`and`** `'2005-03-31 00:00:00'``;`
Generally speaking, you can't mix dates and datetimes.


## 2018-11-15

## é—®é¢˜1:

### ä½¿ç”¨serializer.Serializerè¿›è¡Œcreate() or update()æ“ä½œæ˜¯å¦éœ€è¦ return instance ?

### éœ€è¦ï¼Œåºåˆ—åŒ–å®Œæˆä¹‹åï¼Œè°ƒç”¨save()æ–¹æ³•ï¼Œsave()æ–¹æ³•ä¸­ä¼šæ£€æŸ¥instanceæ˜¯å¦å­˜åœ¨


**å‚è€ƒæºç ï¼š**

```
 def dispatch(instance, import_type, serializer, row_result):
        if import_type == RowResult.IMPORT_TYPE_NEW:
            serializer.save()
            row_result.import_type = RowResult.IMPORT_TYPE_NEW
        elif import_type == RowResult.IMPORT_TYPE_UPDATE:
            serializer.instance = instance
            serializer.save()
            row_result.import_type = RowResult.IMPORT_TYPE_UPDATE
        elif import_type == RowResult.IMPORT_TYPE_SKIP:
            row_result.import_type = RowResult.IMPORT_TYPE_SKIP
        elif import_type == RowResult.IMPORT_TYPE_DELETE:
            instance.delete()
            row_result.import_type = RowResult.IMPORT_TYPE_DELETE
        else:
            # todo raise æ— æ³•è¯†åˆ«çš„ import_type Error
            pass
        return row_result
```

## serializer.save()

[Image: image.png]
## é—®é¢˜2:

### [Return nested serializer in serializer method field](https://stackoverflow.com/questions/33945148/return-nested-serializer-in-serializer-method-field)

### [SerializerMethodField](https://www.django-rest-framework.org/api-guide/fields/#serializermethodfield) ä½¿ç”¨æ–¹æ³•

This is a `read-only field.` It gets its value by calling a method on the serializer class it is attached to. It can be used to add any sort of data to the serialized representation of your object.

**Signature**: `SerializerMethodField(method_name=None)`

* `method_name` - The name of the method on the serializer to be called. If not included this defaults to `get_<field_name>`.
* The serializer method referred to by the `method_name` argument should accept a single argument (in addition to `self`), which is the object being serialized. It should return whatever you want to be included in the serialized representation of the object. For example:

```
from django.contrib.auth.models import User
from django.utils.timezone import now
from rest_framework import serializers

class UserSerializer(serializers.ModelSerializer):
    intermediate_price = serializers.SerializerMethodField()
    intermediate_capacity = serializers.SerializerMethodField()
    
    class Meta:
        model = Intermediate
        fields = ("intermediate_price", "intermediate_capacity")

    def get_intermediate_price(self, obj):
        """è·å–ä¸­é—´ä½“çš„ä»·æ ¼"""
        prices = obj.intermediateprice.all()
        return IntermediatePriceSerializer(prices, many=True, read_only=True).data

    def get_intermediate_capacity(self, obj):
        """è·å–ä¸­é—´ä½“çš„äº§èƒ½æ•°æ®"""
        # è·å–è¯¥ä¸­é—´ä½“çš„æ‰€æœ‰ç”Ÿäº§ä¼ä¸š
        capacity = obj.intermediatecapacity.all()
        return IntermediateCapacitySerializer(capacity, many=True, read_only=True).data
```

**eg:**
[Image: image.png]
## 2018-11-16 

### How to Create Group By Queries With Django ORM

https://simpleisbetterthancomplex.com/tutorial/2016/12/06/how-to-create-group-by-queries.html

## 2018-11-20 

å½“å‰æ—¥æœŸè®¡ç®—ä¸Šä¸€ä¸ªæœˆçš„æ—¥æœŸ

```
`>>> import datetime 
>>> import dateutil.relativedelta
>>> date = datetime.datetime.now().date()
>>> last_month_date =  date + dateutil.relativedelta.relativedelta(months=-1)`
```



## 2018-11-21

[Image: image.png]
## é—®é¢˜2:

https://chase-seibert.github.io/blog/2012/02/24/django-aggregation-group-by-day.html

### Django aggregation, group by day

## 2018-11-22

## é—®é¢˜1

### python program search

https://www.programcreek.com/python/index/module/list

## é—®é¢˜2

### django rest framework cache 

https://github.com/Onyo/django-rest-framework-cache
http://ses4j.github.io/2015/11/23/optimizing-slow-django-rest-framework-performance/

## é—®é¢˜3

https://www.dabapps.com/blog/api-performance-profiling-django-rest-framework/
http://blog.oneapm.com/apm-tech/304.html

## é—®é¢˜4

### DJANGO - DATABASE ACCESS OPTIMIZATION

https://micropyramid.com/blog/django-database-access-optimization/


### BUILDING HIGH PERFORMANCE DJANGO SYSTEMS

https://impythonist.wordpress.com/2016/02/21/building-high-performance-django-systems/

## é—®é¢˜5

### debug-toolbarçš„ä½¿ç”¨

https://www.chenshaowen.com/blog/django-debug-toolbar.html

## 2018-11-25

## é—®é¢˜1

### pythonå½“ä¸­çš„é­”æ³•æ–¹æ³•

https://pycoders-weekly-chinese.readthedocs.io/en/latest/issue6/a-guide-to-pythons-magic-methods.html

## 2018-11-26

## é—®é¢˜1

### GMTæ—¶é—´è½¬ä¸ºDatetime

1ã€å°†datetimeç±»å‹è½¬æ¢æˆHTTPå¤´æ‰€ç”¨çš„GMTæ—¶é—´æ ¼å¼å­—ç¬¦ä¸²

```
import datetime
GMT_FORMAT = '%a, %d %b %Y %H:%M:%S GMT'
datetime.datetime.utcnow().strftime(GMT_FORMAT)
```

2ã€å†çœ‹ä¸‹å¦‚ä½•å°†GMTæ—¶é—´æ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢æˆdatetimeç±»å‹ï¼š

```
TIME = '[2018-11-28 06](tel:2018050806):17:00'
datetime.datetime.strptime(TIME,GMT_FORMAT)
```

3ã€GMTæ—¶é—´ä¸æˆ‘å›½æœ¬åœ°æ—¶é—´æœ‰ä¸ªæ—¶é—´å·®ï¼Œå¦‚æœè¦è½¬æ¢æˆæœ¬åœ°æ—¶é—´ï¼Œéœ€è¦å†åŠ å‡ä¸€æ®µæ—¶é—´

```
datetime.datetime.strptime(TIME,GMT_FORMAT)+datetime.timedelta(hours=8) #è¿™æ ·å°±è½¬æ¢æˆäº†æˆ‘å›½çš„æ—¶é—´äº†ï¼ŒåŒ—äº¬æ—¶é—´æ˜¯ä¸œå…«åŒºï¼Œè¦åŠ ä¸Š8ä¸ªå°æ—¶
```

## é—®é¢˜2

### â€œ2018å¹´11æœˆ26æ—¥â€ è½¬ä¸ºDate

```
>>> from datetime import datetime 
>>> date = datetime.strptime(â€œ2018å¹´2æœˆ3æ—¥â€, â€œ%Yå¹´%Mæœˆ%dæ—¥â€).date()
# è¾“å‡ºç»“æœï¼š
>>> datetime.date(2018, 2, 3)
```

## é—®é¢˜3

### å¸¸ç”¨ä»£ç å—ï¼š

https://github.com/Skycrab/code/blob/acd7590f566fb02a713eb4ab7d8c0be0b32f3b1a/Python/bi/eye_util.py

## 2018-11-27

## é—®é¢˜1

### xmind-sdk-python 

https://pypi.org/project/xmind-sdk/

## é—®é¢˜2 

### ManytoManyField åœ¨ django rest åºåˆ—åŒ–åµŒå¥—ä½¿ç”¨æ—¶æ‰€éœ€å‚æ•°

## [ManyToManyFields with a Through Model](https://www.django-rest-framework.org/api-guide/relations/#manytomanyfields-with-a-through-model)

By default, relational fields that target a `ManyToManyField` with a `through` model specified are set to read-only.
If you explicitly specify a relational field pointing to a `ManyToManyField` with a through model, be sure to set `read_only` to `True`.

**Arguments**:

* `many` - If applied to a to-many relationship, you should set this argument to `True`.

egï¼š

```
news = NewsSerializer(many=True, read_only=True)
```

## é—®é¢˜3 

### zipfile.ZipFileæ˜¯å¦å¯ä»¥æ¥æ”¶file_object

```
*class* **`zipfile.``ZipFile`(*file*, *mode='r'*, *compression=ZIP_STORED*, *allowZip64=True*, *compresslevel=None*)ï¼š
    pass
```

### å‚è€ƒé“¾æ¥ï¼š

https://docs.python.org/3/library/zipfile.html
https://docs.python.org/3/library/zipfile.html#zipfile-objects

### `æºç æŸ¥çœ‹ï¼š`

[Image: image.png]
## é—®é¢˜4

### æ‰©å±•åŒ…åœ¨PyPIä¸Šå‘å¸ƒ

http://www.wbh-doc.com.s3.amazonaws.com/Python-OpenSource-Project-Developer-Guide/Chapter2%20-%20PyPI.html
https://segmentfault.com/a/1190000008663126


## 2018-11-28

## é—®é¢˜1 

### PostgreSQL ä¸­ArrayFieldçš„æŸ¥æ‰¾

æŸ¥è¯¢å…³é”®è¯ï¼šDjango Postgres ArrayField lookup

å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/zh-hans/2.1/ref/contrib/postgres/fields/

### contains

```
**>>> **Post.objects.create(name='First post', tags=['thoughts', 'django'])
**>>> **Post.objects.create(name='Second post', tags=['thoughts'])
**>>> **Post.objects.create(name='Third post', tags=['tutorial', 'django'])
**>>> **Post.objects.filter(tags__contains=['thoughts']) # æ˜¯åˆ—è¡¨ï¼Œä¸æ˜¯å­—ç¬¦ä¸²
<QuerySet [<Post: First post>, <Post: Second post>]
>**>>> **Post.objects.filter(tags__contains=['django'])
<QuerySet [<Post: First post>, <Post: Third post>]>
```



### contained_by

```
>>> Post.objects.create(name='First post', tags=['thoughts', 'django'])
>>> Post.objects.create(name='Second post', tags=['thoughts'])
>>> Post.objects.create(name='Third post', tags=['tutorial', 'django'])
>>> Post.objects.filter(tags__contained_by=['thoughts', 'django'])
<QuerySet [<Post: First post>, <Post: Second post>]>
>>> Post.objects.filter(tags__contained_by=['thoughts', 'django', 'tutorial'])
<QuerySet [<Post: First post>, <Post: Second post>, <Post: Third post>]>
```

## 2018-11-29

## é—®é¢˜1 

## Basic Usage

https://docs.python.org/3/library/json.html#basic-usage

```
json.dumps(obj, skipkeys=False, ensure_ascii=True, check_circular=True, 
allow_nan=True, cls=None, indent=None, separators=None, encoding="utf-8",
default=None, sort_keys=False, **kw)
```

## é—®é¢˜2

## Fluent python â†’ tuple += 

```
>>> t = (1,2 ,[30, 40])
>>> t[2] += [50, 60] # t[2]è¢«æ”¹åŠ¨ä¹ŸæŠ›å‡ºå¼‚å¸¸
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
TypeError: 'tuple' object does not support item assignment
>>> t
(1, 2, [30, 40, 50, 60])

# ä¿®æ”¹ä»£ç 
>>> t = (1,2 ,[30, 40])
>>> t[2].extend([50, 60])
>>> t
(1, 2, [30, 40, 50, 60])
```

æ€»ç»“ï¼š

1. ä¸è¦æŠŠå¯å˜å¯¹è±¡æ”¾åœ¨å…ƒç»„é‡Œé¢
2. å¢é‡èµ‹å€¼ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ

## 2018-11-30

## é—®é¢˜1

## ManytoMany â†’  Relation sets can be cleared

å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/zh-hans/2.1/topics/db/examples/many_to_many/

```
**# åå‘æ“ä½œ
>>> **p2.article_set.clear()
**>>> **p2.article_set.all()
<QuerySet []>
```


And you can clear from the other end:

```
# æ­£å‘æ“ä½œ
>>> a4.publications.all()
<QuerySet [<Publication: Science News>, <Publication: Science Weekly>]>
>>> a4.publications.clear()
>>> a4.publications.all()
<QuerySet []>
>>> p2.article_set.all()
<QuerySet [<Article: Oxygen-free diet works wonders>]>
```

## 2018-12-1

## é—®é¢˜1

## pipenv graph fails: No module named 'pipenv' 

**æŸ¥è¯¢å…³é”®è¯ï¼šImportError: cannot import name 'get_installed_distributions'**
**å‚è€ƒé“¾æ¥ï¼šhttps://github.com/pypa/pipenv/issues/2952**
**é”™è¯¯ä¿¡æ¯ï¼š**
[Image: image.png]**è§£å†³æ–¹æ³•ï¼š**

```
pip install pipenv
pipenv run pip install pip==18.0
pipenv install
```



## 2018-12-3

## é—®é¢˜1

## networkx å’Œ pygraphvizç”Ÿæˆå›¾

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/22214653/10267639

```
import networkx as nx
import pygraphviz as pgv # pygraphviz should be available
G = nx.DiGraph([(dic[0], dic[2]) for dic in dics])
A = nx.nx_agraph.to_agraph(G)
A.draw('example.png', prog='dot')
```

[Image: image.png]

## 2018-12-4

## é—®é¢˜1

### Echarts  graph è®¾ç½®ç®­å¤´

å‚è€ƒé“¾æ¥ï¼š

https://github.com/apache/incubator-echarts/issues/6141
https://ecomfe.github.io/echarts-doc/public/en/option.html#series-graph.edgeSymbol

```
 edgeSymbol: [null, 'arrow'],
 edgeSymbol: ['circle', 'arrow']
```



```
 # http://gallery.echartsjs.com/editor.html?c=xB1XmPH9jb
 series: [{
        name: 'æ‹›æ ‡å€¾å‘æ€§åˆ†æ',
        type: 'graph',
        layout: 'force',
        edgeSymbol: ['circle', 'arrow'],
        // label: {
        // normal: {show: true}
        // },
        edgeLabel: {
        normal: {
            textStyle: {
                fontSize: 20
            }
        }
        },
        force: {
            repulsion: 500,
            edgeLength: 120
        },
```

## é—®é¢˜2

ä½¿ç”¨csvä¿å­˜æ•°æ®

```
import csv

data=[('smith, bob',2),('carol',3),('ted',4),('alice',5)]

with open('file.csv','wb') as out:
    csv_out=csv.writer(out)
    csv_out.writerow(['name','num'])
    for row in data:
        csv_out.writerow(row)
```

## é—®é¢˜3 

ä½¿ç”¨explainæ–¹æ³•ç»Ÿè®¡ä¸€æ¬¡æŸ¥è¯¢æ‰€éœ€è¦çš„æ‰§è¡Œæ—¶é—´

Django 2.1ä¸­QuerySetæ–°å¢äº†explainæ–¹æ³•ï¼Œå¯ä»¥ç»Ÿè®¡ä¸€ä¸ªæŸ¥è¯¢æ‰€æ¶ˆè€—çš„æ‰§è¡Œæ—¶é—´

```
print(Blog.objects.filter(title='My Blog').explain(verbose=True))
```

## 2018-12-7

## é—®é¢˜1

https://www.cnblogs.com/linxiyue/p/4060213.html

```
 user `=` User.objects.create_user(`username``=`validated_data[``'`username`'``],
                                `password``=`validated_data[``'`password`'``],
                                email`=`validated_data[``'email``'``])
```


[Image: image.png]
## 2018-12-8

## é—®é¢˜1 

## djangoä¸­æ—¶åŒºé—®é¢˜

```
`TIME_ZONE` ï¼šDjangoçš„æ—¶åŒº
`TIME_ZONE = 'UTC' # æ ‡å‡†å›½é™…æ—¶é—´ï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼Œä¸ä¸­å›½åŒ—äº¬æ—¶é—´ç›¸å·®8å°æ—¶ï¼‰`
`TIME_ZONE = 'Asia/Shanghai'`ï¼Œè‡ªåŠ¨è½¬æ¢æˆä¸Šæµ·æ—¶é—´æ˜¾ç¤º
```



```
`USE_TZ = False`æ—¶ï¼ŒDjangoä¼šåœ¨ORMæŸ¥è¯¢çš„ç»“æœè¿”å›æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºä¸Šæµ·æ—¶é—´ï¼Œä¸ç®¡æ•°æ®åº“é‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆæ—¶é—´   
```



## é—®é¢˜2 

å‚è€ƒé“¾æ¥ï¼š
https://python3-cookbook.readthedocs.io/zh_CN/latest/c01/p13_sort_list_of_dicts_by_key.html
https://www.dr-chuck.com/csev-blog/2010/01/fun-python-syntax-operator-itemgetter-sorted-and-lambda-functions-oh-my/

## itemgetteråœ¨sortedä¸­çš„ä½¿ç”¨

``operator.itemgetter()`` å‡½æ•°æœ‰ä¸€ä¸ªè¢« ``rows`` ä¸­çš„è®°å½•ç”¨æ¥æŸ¥æ‰¾å€¼çš„ç´¢å¼•å‚æ•°ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå­—å…¸é”®åç§°ï¼Œ ä¸€ä¸ªæ•´å½¢å€¼æˆ–è€…ä»»ä½•èƒ½å¤Ÿä¼ å…¥ä¸€ä¸ªå¯¹è±¡çš„ ``__getitem__()`` æ–¹æ³•çš„å€¼ã€‚ å¦‚æœä½ ä¼ å…¥å¤šä¸ªç´¢å¼•å‚æ•°ç»™ ``itemgetter()`` ï¼Œå®ƒç”Ÿæˆçš„ ``callable`` å¯¹è±¡ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å…ƒç´ å€¼çš„å…ƒç»„ï¼Œ å¹¶ä¸” ``sorted()`` å‡½æ•°ä¼šæ ¹æ®è¿™ä¸ªå…ƒç»„ä¸­å…ƒç´ é¡ºåºå»æ’åºã€‚

``itemgetter()`` æœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç”¨ ``lambda`` è¡¨è¾¾å¼ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š

```
rows_by_fname = sorted(rows, key=**lambda** r: r['fname'])
rows_by_lfname = sorted(rows, key=**lambda** r: (r['lname'],r['fname']))
```


ä½¿ç”¨ ``itemgetter()`` æ–¹å¼ä¼šè¿è¡Œçš„ç¨å¾®å¿«ç‚¹ã€‚å› æ­¤ï¼Œå¦‚æœä½ å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„è¯å°±ä½¿ç”¨ ``itemgetter()`` æ–¹å¼ã€‚

``itemgetter()`` æœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç”¨ ``lambda`` è¡¨è¾¾å¼ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š

```
>>> a = { "a": 9, "b" : 8, "c" : 7 }
>>> b = sorted(a.items())   # Sort by key
>>> b
[('a', 9), ('b', 8), ('c', 7)]
>>> >>> c = sorted(a.items(),key=lambda x: x[1])  # By value
>>> c
[('c', 7), ('b', 8), ('a', 9)]
>>> c = sorted(a.items(),key=lambda x: x[1], reverse=True)  # By Value Backwards
>>> c
[('a', 9), ('b', 8), ('c', 7)]
>>> d = sorted(a.items(),key=lambda x: (x[1], x[0]), reverse=True)  # Value then Key
>>> d
[('a', 9), ('b', 8), ('c', 7)]

```



## é—®é¢˜3

## git ä¸­æ‰“æ ‡ç­¾

å‚è€ƒé“¾æ¥ï¼šhttps://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001376951758572072ce1dc172b4178b910d31bc7521ee4000

### **åˆ›å»ºæ ‡ç­¾**

`git tag <tagname>`ç”¨äºæ–°å»ºä¸€ä¸ªæ ‡ç­¾ï¼Œé»˜è®¤ä¸º`HEAD`ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªcommit idï¼›

```
$ git tag v0.9 f52c633
```

`git tag -a <tagname> -m "æ ‡ç­¾ä¿¡æ¯"`å¯ä»¥æŒ‡å®šæ ‡ç­¾ä¿¡æ¯ï¼›


```
$ git tag -a v1 -m "é¢„å‘å¸ƒç‰ˆæœ¬" 1094adb
```

### æ“ä½œæ ‡ç­¾

### åˆ é™¤æ ‡ç­¾

```
` git tag -d v0.1`
```


**åˆ é™¤è¿œç¨‹æ ‡ç­¾**

```
$ git tag -d v1.0  # å…ˆåˆ é™¤æœ¬åœ°æ ‡ç­¾
$ git push origin :refs/tags/v1.0 # å†åˆ é™¤è¿œç¨‹æ ‡ç­¾
```

**æ€»ç»“**

* å‘½ä»¤`git push origin <tagname>`å¯ä»¥æ¨é€ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›
* å‘½ä»¤`git push origin --tags`å¯ä»¥æ¨é€å…¨éƒ¨æœªæ¨é€è¿‡çš„æœ¬åœ°æ ‡ç­¾ï¼›
* å‘½ä»¤`git tag -d <tagname>`å¯ä»¥åˆ é™¤ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›
* å‘½ä»¤`git push origin :refs/tags/<tagname>`å¯ä»¥åˆ é™¤ä¸€ä¸ªè¿œç¨‹æ ‡ç­¾ã€‚

## 2018-12-12

## é—®é¢˜1:

### åœ¨pandas DataFrameä¸­å°†æŸä¸€åˆ—æ•°æ®ç±»å‹ä¸ºtimestampè½¬ä¸ºå­—ç¬¦ä¸²å¹¶ä¿®æ”¹æ ¼å¼

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/questions/35312981/using-pandas-to-datetime-with-timestamps
æŸ¥è¯¢å…³é”®è¯å‚è€ƒï¼š[Using pandas to_datetime with timestamps](https://stackoverflow.com/questions/35312981/using-pandas-to-datetime-with-timestamps)

```
datas = pd.read_excel(file_obj)
# å°†pandasä¸­è§£æå‡ºæ¥çš„æ•°æ®ä¸ºNullçš„ç”¨Noneä»£æ›¿
datas = customs_datas.where(customs_datas.notnull(), None)
# unit
datas['æ—¥æœŸ'] = pd.to_datetime(customs_datas['æ—¥æœŸ'], unit='s').dt.strftime("%Y-%m-%d")
```

```
# æ•ˆç‡ä½å†™æ³•ï¼ˆæ•°æ®é‡å¤šå°±ggï¼‰
for customs_datas_list in customs_datas_lists:
    customs_datas_list['æ—¥æœŸ'] = datetime.datetime.strftime(customs_datas_list['æ—¥æœŸ'], "%Y-%m-%d")
```



## é—®é¢˜2

###  DataFrame to json 

ï¼ˆä¹‹åæ•´ç†ï¼‰
å‚è€ƒé“¾æ¥ï¼šhttps://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_json.html

```
 # è½¬ä¸ºå­—ç¬¦ä¸²   ç§’çº§åˆ« ï¼ˆæ•°æ®é‡å¤§å°±å´©äº†ï¼‰ 
 df.to_json(orient='records')
 '[{"col 1":"a","col 2":"b"},{"col 1":"c","col 2":"d"}]'
```



## 2018-12-13

## é—®é¢˜1ï¼š

### listä¸­è¾¹éå†è¾¹åˆ é™¤

https://stackoverflow.com/questions/1207406/how-to-remove-items-from-a-list-while-iterating
https://stackoverflow.com/a/1208792

```
# å€’åºéå† 
for i in range(len(somelist) - 1, -1, -1):
    if some_condition(somelist, i):
        del somelist[i]
```

## 2018-12-14 

## é—®é¢˜1ï¼š

å‚è€ƒï¼š[2018-11-20](https://hujialou.quip.com/XmkJAY4lbraa#GEBACAIsmZk)

### æŒ‰ç…§å½“å‰æ—¥æœŸè®¡ç®—ä¸‹ä¸€ä¸ªæœˆçš„æ—¥æœŸ

```
`s  = datetime.date(2018, 12, 1)`
`>>> s `
`datetime.date(2018, 12, 1)`
`>>> from dateutil.relativedelta import relativedelta`
`>>> s + relativedelta(months=+1)`
`datetime.date(2019, 1, 1)`
```

## 2018-12-18

æœªæ•´ç†

## é—®é¢˜1:

### mac ä¸Šä½¿ç”¨pyenvå‡ºç°çš„é—®é¢˜

### pyenv global 3.6.6  ä¸ç”Ÿæ•ˆ

å‚è€ƒé“¾æ¥ï¼š
https://github.com/pyenv/pyenv
MacOS 10.12 + zsh install issueï¼šhttps://github.com/pyenv/pyenv/issues/846

https://github.com/sorin-ionescu/prezto/issues/381

macå®‰è£…æ—¶æ³¨æ„ï¼š
Zsh note: Modify your `~/.zshenv` file instead of `~/.bash_profile`. Ubuntu and Fedora note: Modify your `~/.bashrc` file instead of `~/.bash_profile`. Proxy note: If you use a proxy, export `http_proxy` and `HTTPS_PROXY`too.

## é—®é¢˜2ï¼š

é¡¹ç›®ä¸­å®‰è£…poetryæ˜¾ç¤ºï¼š zsh: not found poetry 
https://github.com/sdispater/poetry#installation


```
# å¯ä»¥æ­£å¸¸å®‰è£…
curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py | python

# zsh: poetry command not found 
poetry install 

```



å‚è€ƒé“¾æ¥ï¼š
**/bin/sh: poetry: not found**ï¼šhttps://github.com/sdispater/poetry/issues/525
**Poetry Command Not Found on zs**:https://github.com/sdispater/poetry/issues/507

### è§£å†³æ–¹æ³•ï¼š

Just to check: if you create a `~/.zprofile` and add `export PATH="$HOME/.poetry/bin:$PATH"` to it and then restart your shellã€‚

## 2018-12-19 

## é—®é¢˜1ï¼š

can do make a schedule for running code every month ?

å‚è€ƒé“¾æ¥ï¼š
https://github.com/dbader/schedule/issues/73
Longer time intervalsï¼šhttps://github.com/dbader/schedule/issues/82 
è§£å†³æ–¹æ³•ï¼š
`every(30).days.do(...)`

å­˜åœ¨çš„é—®é¢˜ï¼š
æ¯å½“æœºå™¨æˆ–è€…æœåŠ¡é‡å¯ï¼Œè®¡æ—¶å™¨ä¹Ÿä¼šé‡ç½®


```
# complex schedule
import datetime
import sys

# End date
end_day = 10
end_month = 3

def job():
    #  check the current date with the end date
    cur = datetime.datetime.now()
    if cur.day = end_day and cur.month == end_month:
        sys.exit()

    # otherwise, run your job
    print("hello world!")
```

## 2018-12-20

## é—®é¢˜1 

pandas æµ‹è¯•ä¸­ä½¿ç”¨äº† xlrd 
[Image: image.png][Image: image.png]
```
# å®‰è£…
poetry add xlrd 
```

## é—®é¢˜2

## Auto-detecting the n+1 queries problem in Python

### å‚è€ƒé“¾æ¥ï¼š

https://github.com/jmcarp/nplusone


## 2018-12-21

## é—®é¢˜1

## postgresql dump database

### å‚è€ƒé“¾æ¥ï¼šhttps://www.postgresql.org/docs/9.4/backup-dump.html

### Handling Large Databases

**Use compressed dumps.** You can use your favorite compression program, for example gzip:

```
pg_dump `dbname` | gzip > `filename`.gz
```


Reload with:

```
gunzip -c `filename`.gz | psql `dbname`
```


or:

```
cat `filename`.gz | gunzip | psql `dbname`
```


**Use** **`split`.** The `split` command allows you to split the output into smaller files that are acceptable in size to the underlying file system. For example, to make chunks of 1 megabyte:

```
pg_dump `dbname` | split -b 1m - `filename`
```


Reload with:

```
cat `filename`* | psql `dbname`
```


[Image: image.png][Image: image.png][Image: image.png]
[Image: image.png]

## 2018-12-23

## é—®é¢˜1ï¼šDjango ä¸­æ‰¹é‡åˆ›å»ºå¯¹è±¡ 

å‚è€ƒé“¾æ¥ï¼šhttps://docs.djangoproject.com/en/2.1/ref/models/querysets/#bulk-create

`bulk_create`**(***objs***,** *****batch_size=None***)**[Â¶](https://docs.djangoproject.com/en/2.1/ref/models/querysets/#django.db.models.query.QuerySet.bulk_create)ï¼ˆä¸Šä¸‡æ¡æ•°æ®æ¯«ç§’çº§åˆ«ï¼‰

ä¸»è¦åŸç†ï¼šåˆ©ç”¨äº†djangoçš„æ‡’åŠ è½½

```
from itertools import islice

batch_size = 100
objs = (Entry(headline='Test %s' % i) for i in range(1000))
while True:
    batch = list(islice(objs, batch_size))
    if not batch:
        break
    Entry.objects.bulk_create(batch, batch_size)
```

## é—®é¢˜2

### 'int' object has no attribute 'encode' 

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/43321769

That's because you're passing an integer in the JSON and you don't cast it as string later while Django expects a string for the password.
So make sure you cast the password as string:

```
`password = str(request.data['password'])`
```



## é—®é¢˜3

security:å®‰å…¨

```
django.middleware.security.SecurityMiddleware
```




## é—®é¢˜4

djagno Rest Frameworkä¸­é’ˆå¯¹ä¸åŒçš„æ–¹æ³•ï¼ˆlistã€retrieveã€deleteï¼‰ä½¿ç”¨ä¸åŒçš„queryset 

å…³é”®ï¼š`self`
[Image: image.png][Image: image.png][Image: image.png]
```
class xxxxViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, viewsets.GenericViewSet):

    def get_serializer_class(self):
        if self.action == 'list':
            return xxxxSerializer
        else:
            return xxxxDetailSerializer

    def get_queryset(self):
        if self.action == 'list':
            queryset = xxxx.objects.filter(xxx__xxxx__display="æ˜¯").distinct()
        else:
            queryset = xxxx.objects.all().distinct()
        return queryset
```

## é—®é¢˜5

## å…³é—­Django REST framework çš„æµ‹è¯•é¡µé¢

å‚è€ƒé“¾æ¥ï¼šhttps://www.django-rest-framework.org/api-guide/renderers/

```
`REST_FRAMEWORK = {
'DEFAULT_RENDERER_CLASSES':
('rest_framework.renderers.JSONRenderer',
 'rest_framework.renderers.BrowsableAPIRenderer',
 )}`
```



```
`**REST_FRAMEWORK** = {
    'DEFAULT_RENDERER_CLASSES': (
        'rest_framework.renderers.**JSONRenderer**',
    )
}`
```



## 2018-12-24

## é—®é¢˜1 

### Django REST Framework: 'BasePermissionMetaclass' object is not iterable

å‚è€ƒé“¾æ¥ï¼šhttps://stackoverflow.com/a/53650052

You have mistyped the comma in `DEFAULT_PERMISSION_CLASSES` value, due to which Django takes it as a string, instead of a tuple.

**Solution**:

```
`REST_FRAMEWORK =
{...'DEFAULT_PERMISSION_CLASSES': ( 'rest_framework.permissions.IsAdminUser', ),
...}`
```


[Image: image.png]
## é—®é¢˜2

## æ¸…é™¤redisä¸­æ‰€æœ‰çš„ç¼“å­˜

å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/a/6851929/10267639
http://www.redis.cn/commands/flushall.html
http://www.redis.cn/commands/flushdb.html

### flushall 

åˆ é™¤æ‰€æœ‰æ•°æ®åº“é‡Œé¢çš„æ‰€æœ‰æ•°æ®ï¼Œæ³¨æ„ä¸æ˜¯å½“å‰æ•°æ®åº“ï¼Œè€Œæ˜¯æ‰€æœ‰æ•°æ®åº“ã€‚
è¿™ä¸ªå‘½ä»¤æ°¸è¿œä¸ä¼šå‡ºç°å¤±è´¥ã€‚
è¿™ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(N)`,Næ˜¯æ•°æ®åº“çš„æ•°é‡ã€‚

### flushdb

åˆ é™¤å½“å‰æ•°æ®åº“é‡Œé¢çš„æ‰€æœ‰æ•°æ®ã€‚
è¿™ä¸ªå‘½ä»¤æ°¸è¿œä¸ä¼šå‡ºç°å¤±è´¥ã€‚
è¿™ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(N)`,Næ˜¯å½“å‰æ•°æ®åº“çš„keysæ•°é‡ã€‚

### in shell:

```
`redis-cli flushall`
```



## 2018-12-26

## é—®é¢˜1

## JWT_EXPIRATION_DELTA å’Œ JWT_REFRESH_EXPIRATION_DELTA çš„åŒºåˆ«

å‚è€ƒé“¾æ¥ï¼š
https://stackoverflow.com/a/26834685/10267639
https://github.com/GetBlimp/django-rest-framework-jwt/issues/92#issuecomment-212846352


```
JWT_AUTH = {
    'JWT_ALLOW_REFRESH': True,
    'JWT_EXPIRATION_DELTA': datetime.timedelta(seconds=12),
    'JWT_REFRESH_EXPIRATION_DELTA': datetime.timedelta(days=7),
}
```

**JWT_REFRESH_EXPIRATION_DELTA**ï¼šè‡ªåŸå§‹tokenè¢«å‘å¸ƒä»¥åï¼Œå¤šé•¿æ—¶é—´èŒƒå›´å†…å®ƒä»¥åŠå®ƒçš„å­å­™tokenå¯ä»¥è¢«ç”¨æ¥åˆ·æ–°ä»¥è·å¾—æ–°çš„å­å­™tokenã€‚

**åŸå§‹token**ï¼šé€šè¿‡ç”¨æˆ·å/å¯†ç éªŒè¯åè·å¾—çš„tokenï¼ˆå³obtain_jwt_tokenæ¥å£è¿”å›çš„tokenï¼‰ï¼ŒåŸå§‹tokenåˆ·æ–°åè·å¾—çš„token1ï¼Œä»¥åŠtoken1ç»§ç»­åˆ·æ–°è·å¾—çš„token2ã€token2å†è·å¾—token3â€¦â€¦å½¢æˆäº†ä¸€ä¸²tokené“¾ï¼Œtokené“¾çš„è¿‡æœŸæ—¶é—´JWT_EXPIRATION_DELTAã€‚

**ç„¶è€Œ**è¿™ä¸²tokené“¾ä¸èƒ½ä¸€ç›´æ— é™åˆ¶åˆ·æ–°ä¸‹å»ï¼Œç›´åˆ°åŸå§‹tokenå‘å¸ƒåçš„JWT_REFRESH_EXPIRATION_DELTAåï¼Œåˆ·æ–°æ“ä½œå°†è¢«ç»ˆæ­¢ï¼Œæ¡†æ¶ä¼šè¿”å›HTTP 400ã€‚ä¹‹ååˆ™å¿…é¡»å‘obtain_jwt_tokenè¯·æ±‚æ¥è·å–æ–°çš„åŸå§‹tokenã€‚

å†å›åˆ°5mins + 7daysçš„é»˜è®¤è®¾ç½®ä¸Šæ¥ï¼Œå®¢æˆ·ç«¯é¦–å…ˆè°ƒç”¨obtain_jwt_tokenè¿›è¡Œç™»å½•æ“ä½œï¼Œä¹‹åå¿…é¡»æ¯éš”å°äº5åˆ†é’Ÿå°±åˆ·æ–°ä¸€æ¬¡tokenï¼Œæ‰èƒ½ä¿è¯ä¸æ‰çº¿ã€‚ç„¶è€Œå³ä½¿ä¸€ç›´ä¿æŒåœ¨çº¿ï¼Œä¸Šé™ä¹Ÿåªæœ‰7å¤©ï¼Œ7å¤©è¿‡åå¿…é¡»é‡æ–°ç™»å½•ï¼Œè¿™æ‰æ˜¯5mins + 7daysçš„ç¡®åˆ‡å«ä¹‰ã€‚

## é—®é¢˜2

## Django N+1 query solution

https://stackoverflow.com/questions/5422189/django-n1-query-solution
http://blog.oneapm.com/apm-tech/304.html

## **Optimizing slow Django REST Framework performance**

http://ses4j.github.io/2015/11/23/optimizing-slow-django-rest-framework-performance/

https://stackoverflow.com/questions/26593312/optimizing-database-queries-in-django-rest-framework/41287459

https://stackoverflow.com/a/41287459/10267639

****è‡ªåŠ¨æ£€æµ‹n+1æ¨èä½¿ç”¨****
nplusone ï¼ˆhttps://github.com/jmcarp/nplusoneï¼‰
 ****Django N+1 query solutionæ–¹æ³•å‚è€ƒ****

1. https://stackoverflow.com/questions/5422189/django-n1-query-solution 
2. http://blog.oneapm.com/apm-tech/304.html 

****Optimizing slow Django REST Framework performanceå¯å‚è€ƒ****

1.  http://ses4j.github.io/2015/11/23/optimizing-slow-django-rest-framework-performance/ https://stackoverflow.com/questions/26593312/optimizing-database-queries-in-django-rest-framework/41287459
2.  https://stackoverflow.com/a/41287459/10267639 
3. https://www.dabapps.com/blog/api-performance-profiling-django-rest-framework/